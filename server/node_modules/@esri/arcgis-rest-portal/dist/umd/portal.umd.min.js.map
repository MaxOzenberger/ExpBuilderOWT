{"version":3,"file":"portal.umd.min.js","sources":["../../src/util/get-portal-url.ts","../../src/items/helpers.ts","../../src/items/update.ts","../../src/items/create.ts","../../src/util/scrub-control-chars.ts","../../src/items/get.ts","../../src/groups/get.ts","../../src/sharing/helpers.ts","../../src/util/SearchQueryBuilder.ts","../../src/util/generic-search.ts","../../src/items/search.ts","../../src/util/array.ts","../../src/groups/add-users.ts","../../src/groups/remove-users.ts","../../src/groups/invite-users.ts","../../src/groups/update-user-membership.ts","../../src/orgs/notification.ts","../../src/users/get-user.ts","../../src/sharing/access.ts","../../src/sharing/is-item-shared-with-group.ts","../../src/sharing/share-item-with-group.ts","../../src/util/get-portal.ts","../../src/users/invitation.ts","../../src/items/add.ts","../../src/items/upload.ts","../../src/groups/create.ts","../../src/groups/notification.ts","../../src/items/export.ts","../../src/util/get-portal-settings.ts","../../src/items/content.ts","../../src/users/notification.ts","../../src/users/get-user-tags.ts","../../src/users/get-user-url.ts","../../src/groups/join.ts","../../src/groups/protect.ts","../../src/items/protect.ts","../../src/items/reassign.ts","../../src/items/remove.ts","../../src/groups/remove.ts","../../src/groups/search.ts","../../src/users/search-users.ts","../../src/sharing/unshare-item-with-group.ts","../../src/groups/update.ts","../../src/users/update.ts"],"sourcesContent":["/* Copyright (c) 2017 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { IRequestOptions, cleanUrl } from \"@esri/arcgis-rest-request\";\n\n/**\n * Helper that returns the appropriate portal url for a given request. `requestOptions.portal` is given\n * precedence over `authentication.portal`. If neither are present, `www.arcgis.com/sharing/rest` is returned.\n *\n * @param requestOptions - Request options that may have authentication manager\n * @returns Portal url to be used in API requests\n */\nexport function getPortalUrl(requestOptions: IRequestOptions = {}): string {\n  // use portal in options if specified\n  if (requestOptions.portal) {\n    return cleanUrl(requestOptions.portal);\n  }\n\n  // if auth was passed, use that portal\n  if (requestOptions.authentication) {\n    // the portal url is already scrubbed in the auth package\n    return requestOptions.authentication.portal;\n  }\n\n  // default to arcgis.com\n  return \"https://www.arcgis.com/sharing/rest\";\n}\n","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { IRequestOptions, ArcGISRequestError } from \"@esri/arcgis-rest-request\";\nimport { IItemAdd, IItemUpdate, IItem } from \"@esri/arcgis-rest-types\";\nimport { IUserRequestOptions } from \"@esri/arcgis-rest-auth\";\n\n/**\n * Base options interface for making authenticated requests for items.\n */\nexport interface IUserItemOptions extends IUserRequestOptions {\n  /**\n   * Unique identifier of the item.\n   */\n  id: string;\n  /**\n   * Item owner username. If not present, `authentication.username` is utilized.\n   */\n  owner?: string;\n}\n\nexport interface IFolderIdOptions extends IUserRequestOptions {\n  /**\n   * Unique identifier of the folder.\n   */\n  folderId: string;\n  /**\n   * Item owner username. If not present, `authentication.username` is utilized.\n   */\n  owner?: string;\n}\n\nexport type ItemRelationshipType =\n  | \"APIKey2Item\"\n  | \"Area2CustomPackage\"\n  | \"Area2Package\"\n  | \"Item2Attachment\"\n  | \"Item2Report\"\n  | \"Listed2Provisioned\"\n  | \"Map2AppConfig\"\n  | \"Map2Area\"\n  | \"Map2FeatureCollection\"\n  | \"Map2Service\"\n  | \"MobileApp2Code\"\n  | \"Service2Data\"\n  | \"Service2Layer\"\n  | \"Service2Route\"\n  | \"Service2Service\"\n  | \"Service2Style\"\n  | \"Solution2Item\"\n  | \"Style2Style\"\n  | \"Survey2Data\"\n  | \"Survey2Service\"\n  | \"SurveyAddIn2Data\"\n  | \"Theme2Story\"\n  | \"TrackView2Map\"\n  | \"WebStyle2DesktopStyle\"\n  | \"WMA2Code\"\n  | \"WorkforceMap2FeatureService\"\n\n/**\n * Names of methods for reading the body of a fetch response, see:\n * https://developer.mozilla.org/en-US/docs/Web/API/Body#Methods\n */\nexport type FetchReadMethodName =\n  | \"arrayBuffer\"\n  | \"blob\"\n  | \"formData\"\n  | \"json\"\n  | \"text\";\n\nexport interface IItemRelationshipOptions extends IRequestOptions {\n  /**\n   * Unique identifier of the item.\n   */\n  id: string;\n  /**\n   * The type of relationship between the two items.\n   */\n  relationshipType: ItemRelationshipType | ItemRelationshipType[];\n  /**\n   * The direction of the relationship. Either forward (from origin -> destination) or reverse (from destination -> origin).\n   */\n  direction?: \"forward\" | \"reverse\";\n}\n\nexport interface IManageItemRelationshipOptions extends IUserRequestOptions {\n  originItemId: string;\n  destinationItemId: string;\n  relationshipType: ItemRelationshipType;\n}\n\nexport interface IItemInfoOptions extends IUserItemOptions {\n  /**\n   * Subfolder for added information.\n   */\n  folderName?: string;\n  /**\n   * Object to store\n   */\n  file: any;\n}\n\nexport interface IItemResourceOptions extends IUserItemOptions {\n  /**\n   * New resource filename.\n   */\n  name?: string;\n  /**\n   * Folder in which to store the new resource.\n   */\n  prefix?: string;\n  /**\n   * Text input to be added as a file resource.\n   */\n  content?: string;\n  /**\n   * Controls whether access to the file resource is restricted to the owner or inherited from the sharing permissions set for the associated item.\n   */\n  private?: boolean;\n  /**\n   * Object to store\n   */\n  resource?: any;\n}\n\nexport interface ICreateUpdateItemOptions extends IUserRequestOptions {\n  /**\n   * The owner of the item. If this property is not present, `item.owner` will be passed, or lastly `authentication.username`.\n   */\n  owner?: string;\n  /**\n   * Id of the folder to house the item.\n   */\n  folderId?: string;\n  /**\n   * The file to be uploaded. If uploading a file, the request must be a multipart request.\n   */\n  file?: any;\n  /**\n   * The URL where the item can be downloaded. The resource will be downloaded and stored as a file type. Similar to uploading a file to be added, but instead of transferring the contents of the file, the URL of the data file is referenced and creates a file item.\n   */\n  dataUrl?: string;\n  /**\n   * The text content for the item to be submitted.\n   */\n  text?: string;\n  /**\n   * If true, the file is uploaded asynchronously. If false, the file is uploaded synchronously.\n   */\n  async?: boolean;\n  /**\n   * If true, the file is uploaded in multiple parts.\n   */\n  multipart?: boolean;\n  /**\n   * The filename being uploaded in multipart mode. Required if multipart=true.\n   */\n  filename?: string;\n  /**\n   * If true, overwrite the existing file.\n   */\n  overwrite?: boolean;\n}\n\nexport interface IItemDataOptions extends IRequestOptions {\n  /**\n   * Used to request binary data.\n   */\n  file?: boolean;\n}\n\nexport interface IItemPartOptions extends IUserItemOptions {\n  /**\n   * The file part to be uploaded.\n   */\n  file: any;\n  /**\n   * Part numbers can be any number from 1 to 10,000, inclusive. A part number uniquely identifies a part and also defines its position within the object being created. If you upload a new part using the same part number that was used with a previous part, the previously uploaded part is overwritten.\n   */\n  partNum: number;\n}\n\nexport interface IUpdateItemResponse {\n  success: boolean;\n  id: string;\n}\n\nexport interface IItemInfoResponse {\n  success: boolean;\n  itemId: string;\n  owner: string;\n  folder: string;\n}\n\nexport interface IItemResourceResponse {\n  success: boolean;\n  itemId: string;\n  owner: string;\n  folder: string;\n}\n\nexport interface IAddFolderResponse {\n  /**\n   * Success or failure of request.\n   */\n  success: boolean;\n  /**\n   * Information about created folder: its alphanumeric id, name, and owner's name.\n   */\n  folder: {\n    id: string;\n    title: string;\n    username: string;\n  };\n}\n\nexport interface IMoveItemResponse {\n  /**\n   * Success or failure of request.\n   */\n  success: boolean;\n  /**\n   * Alphanumeric id of moved item.\n   */\n  itemId: string;\n  /**\n   * Name of owner of item.\n   */\n  owner: string;\n  /**\n   * Alphanumeric id of folder now housing item.\n   */\n  folder: string;\n}\n\n/**\n * Serialize an item and its data into a json format accepted by the Portal API for create and update operations\n *\n * @param item Item to be serialized\n * @returns a formatted json object to be sent to Portal\n */\nexport function serializeItem(item: IItemAdd | IItemUpdate | IItem): any {\n  // create a clone so we're not messing with the original\n  const clone = JSON.parse(JSON.stringify(item));\n\n  // binary data needs POSTed as a `file`\n  // JSON object literals should be passed as `text`.\n  if (clone.data) {\n    (typeof Blob !== \"undefined\" && item.data instanceof Blob) ||\n    // Node.js doesn't implement Blob\n    item.data.constructor.name === \"ReadStream\"\n      ? (clone.file = item.data)\n      : (clone.text = item.data);\n    delete clone.data;\n  }\n  return clone;\n}\n\n/**\n * `requestOptions.owner` is given priority, `requestOptions.item.owner` will be checked next. If neither are present, `authentication.getUserName()` will be used instead.\n */\nexport function determineOwner(requestOptions: any): Promise<string> {\n  if (requestOptions.owner) {\n    return Promise.resolve(requestOptions.owner);\n  } else if (requestOptions.item && requestOptions.item.owner) {\n    return Promise.resolve(requestOptions.item.owner);\n  } else if (\n    requestOptions.authentication &&\n    requestOptions.authentication.getUsername\n  ) {\n    return requestOptions.authentication.getUsername();\n  } else {\n    return Promise.reject(\n      new Error(\n        \"Could not determine the owner of this item. Pass the `owner`, `item.owner`, or `authentication` option.\"\n      )\n    );\n  }\n}\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request, IRequestOptions } from \"@esri/arcgis-rest-request\";\nimport { IItemUpdate } from \"@esri/arcgis-rest-types\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport {\n  ICreateUpdateItemOptions,\n  IMoveItemResponse,\n  IItemInfoOptions,\n  IItemResourceOptions,\n  IItemInfoResponse,\n  IItemResourceResponse,\n  IUpdateItemResponse,\n  serializeItem,\n  determineOwner\n} from \"./helpers\";\n\nexport interface IUpdateItemOptions extends ICreateUpdateItemOptions {\n  item: IItemUpdate;\n}\n\nexport interface IMoveItemOptions extends ICreateUpdateItemOptions {\n  /**\n   * Alphanumeric id of item to be moved.\n   */\n  itemId: string;\n  /**\n   * Alphanumeric id of folder to house moved item. If null, empty, or \"/\", the destination is the\n   * root folder.\n   */\n  folderId?: string;\n}\n\n/**\n * ```js\n * import { updateItem } from \"@esri/arcgis-rest-portal\";\n * //\n * updateItem({\n *   item: {\n *     id: \"3ef\",\n *     description: \"A three hour tour\"\n *   },\n *   authentication\n * })\n *   .then(response)\n * ```\n * Update an Item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-item.htm) for more information.\n *\n * @param requestOptions - Options for the request.\n * @returns A Promise that updates an item.\n */\nexport function updateItem(\n  requestOptions: IUpdateItemOptions\n): Promise<IUpdateItemResponse> {\n  return determineOwner(requestOptions).then(owner => {\n    const url = requestOptions.folderId\n      ? `${getPortalUrl(requestOptions)}/content/users/${owner}/${requestOptions.folderId}/items/${requestOptions.item.id}/update`\n      : `${getPortalUrl(requestOptions)}/content/users/${owner}/items/${requestOptions.item.id}/update`;\n\n    // serialize the item into something Portal will accept\n    requestOptions.params = {\n      ...requestOptions.params,\n      ...serializeItem(requestOptions.item)\n    };\n\n    return request(url, requestOptions);\n  });\n}\n\n/**\n * ```js\n * import { updateItemInfo } from \"@esri/arcgis-rest-portal\";\n * //\n * updateItemInfo({\n *   id: '3ef',\n *   file: file,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Update an info file associated with an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-info.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that updates an item info file.\n */\nexport function updateItemInfo(\n  requestOptions: IItemInfoOptions\n): Promise<IItemInfoResponse> {\n  return determineOwner(requestOptions).then(owner => {\n    const url = `${getPortalUrl(\n      requestOptions as IRequestOptions\n    )}/content/users/${owner}/items/${requestOptions.id}/updateinfo`;\n\n    // mix in user supplied params\n    requestOptions.params = {\n      folderName: requestOptions.folderName,\n      file: requestOptions.file,\n      ...requestOptions.params\n    };\n\n    return request(url, requestOptions);\n  });\n}\n\n/**\n * ```js\n * import { updateItemResource } from \"@esri/arcgis-rest-portal\";\n * //\n * updateItemResource({\n *   id: '3ef',\n *   resource: file,\n *   name: 'bigkahuna.jpg',\n *   authentication\n * })\n *   .then(response)\n * ```\n * Update a resource associated with an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-resources.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that updates an item resource.\n */\nexport function updateItemResource(\n  requestOptions: IItemResourceOptions\n): Promise<IItemResourceResponse> {\n  return determineOwner(requestOptions).then(owner => {\n    const url = `${getPortalUrl(\n      requestOptions as IRequestOptions\n    )}/content/users/${owner}/items/${requestOptions.id}/updateResources`;\n\n    // mix in user supplied params\n    requestOptions.params = {\n      file: requestOptions.resource,\n      fileName: requestOptions.name,\n      resourcesPrefix: requestOptions.prefix,\n      text: requestOptions.content,\n      ...requestOptions.params\n    };\n\n    // only override the access specified previously if 'private' is passed explicitly\n    if (typeof requestOptions.private !== \"undefined\") {\n      requestOptions.params.access = requestOptions.private\n        ? \"private\"\n        : \"inherit\";\n    }\n    return request(url, requestOptions);\n  });\n}\n\n/**\n * ```js\n * import { moveItem } from \"@esri/arcgis-rest-portal\";\n * //\n * moveItem({\n *   itemId: \"3ef\",\n *   folderId: \"7c5\",\n *   authentication: userSession\n * })\n * ```\n * Move an item to a folder. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/move-item.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that resolves with owner and folder details once the move has been completed\n */\nexport function moveItem(\n  requestOptions: IMoveItemOptions\n): Promise<IMoveItemResponse> {\n  return determineOwner(requestOptions).then(owner => {\n    const url = `${getPortalUrl(requestOptions)}/content/users/${owner}/items/${\n      requestOptions.itemId\n    }/move`;\n\n    let folderId = requestOptions.folderId;\n    if (!folderId) {\n      folderId = \"/\";\n    }\n    requestOptions.params = {\n      folder: folderId,\n      ...requestOptions.params\n    };\n\n    return request(url, requestOptions);\n  });\n}\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\nimport { IItemAdd } from \"@esri/arcgis-rest-types\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport {\n  IAddFolderResponse,\n  IUpdateItemResponse,\n  ICreateUpdateItemOptions,\n  serializeItem,\n  determineOwner\n} from \"./helpers\";\n\nexport interface ICreateFolderOptions extends ICreateUpdateItemOptions {\n  /**\n   * Name of the folder to create.\n   */\n  title: string;\n}\n\nexport interface ICreateItemOptions extends ICreateUpdateItemOptions {\n  item: IItemAdd;\n}\n\nexport interface ICreateItemResponse extends IUpdateItemResponse {\n  folder: string;\n}\n\n/**\n * ```js\n * import { createFolder } from \"@esri/arcgis-rest-portal\";\n * //\n * createFolder({\n *   title: 'Map Collection',\n *   authentication: userSession\n * })\n *   .then(response)\n * ```\n * Create a folder. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/create-folder.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that resolves with folder details once the folder has been created\n */\nexport function createFolder(\n  requestOptions: ICreateFolderOptions\n): Promise<IAddFolderResponse> {\n  return determineOwner(requestOptions).then(owner => {\n    const baseUrl = `${getPortalUrl(requestOptions)}/content/users/${owner}`;\n    const url = `${baseUrl}/createFolder`;\n\n    requestOptions.params = {\n      title: requestOptions.title,\n      ...requestOptions.params\n    };\n\n    return request(url, requestOptions);\n  });\n}\n\n/**\n * ```js\n * import { createItemInFolder } from \"@esri/arcgis-rest-portal\";\n * //\n * createItemInFolder({\n *   item: {\n *     title: \"The Amazing Voyage\",\n *     type: \"Web Map\"\n *   },\n *   folderId: 'fe8',\n *   authentication\n * })\n * ```\n * Create an item in a folder. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/add-item.htm) for more information.\n *\n * @param requestOptions = Options for the request\n */\nexport function createItemInFolder(\n  requestOptions: ICreateItemOptions\n): Promise<ICreateItemResponse> {\n  if (requestOptions.multipart && !requestOptions.filename) {\n    return Promise.reject(\n      new Error(\"The filename is required for a multipart request.\")\n    );\n  }\n\n  return determineOwner(requestOptions).then(owner => {\n    const baseUrl = `${getPortalUrl(requestOptions)}/content/users/${owner}`;\n    let url = `${baseUrl}/addItem`;\n\n    if (requestOptions.folderId) {\n      url = `${baseUrl}/${requestOptions.folderId}/addItem`;\n    }\n\n    requestOptions.params = {\n      ...requestOptions.params,\n      ...serializeItem(requestOptions.item)\n    };\n\n    // serialize the item into something Portal will accept\n    const options = appendCustomParams<ICreateItemOptions>(\n      requestOptions,\n      [\n        \"owner\",\n        \"folderId\",\n        \"file\",\n        \"dataUrl\",\n        \"text\",\n        \"async\",\n        \"multipart\",\n        \"filename\",\n        \"overwrite\"\n      ],\n      {\n        params: { ...requestOptions.params }\n      }\n    );\n\n    return request(url, options);\n  });\n}\n\n/**\n * ```js\n * import { createItem } from \"@esri/arcgis-rest-portal\";\n * //\n * createItem({\n *   item: {\n *     title: \"The Amazing Voyage\",\n *     type: \"Web Map\"\n *   },\n *   authentication\n * })\n * ```\n * Create an Item in the user's root folder. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/add-item.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that creates an item.\n */\nexport function createItem(\n  requestOptions: ICreateItemOptions\n): Promise<ICreateItemResponse> {\n  // delegate to createItemInFolder placing in the root of the filestore\n  const options = {\n    folderId: null,\n    ...requestOptions\n  } as ICreateItemOptions;\n  return createItemInFolder(options);\n}\n","const CONTROL_CHAR_MATCHER = /[\\x00-\\x1F\\x7F-\\x9F\\xA0]/g;\n\n/**\n * Returns a new string with all control characters removed.\n *\n * Doesn't remove characters from input string.\n *\n * @param str - the string to scrub\n */\nexport function scrubControlChars (str: string) {\n  return str.replace(CONTROL_CHAR_MATCHER, \"\");\n}\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport {\n  request,\n  IRequestOptions,\n  appendCustomParams\n} from \"@esri/arcgis-rest-request\";\nimport { IItem, IGroup } from \"@esri/arcgis-rest-types\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { scrubControlChars } from '../util/scrub-control-chars';\nimport {\n  IItemDataOptions,\n  IItemRelationshipOptions,\n  IUserItemOptions,\n  determineOwner,\n  FetchReadMethodName\n} from \"./helpers\";\n\n/**\n * ```\n * import { getItem } from \"@esri/arcgis-rest-portal\";\n * //\n * getItem(\"ae7\")\n *   .then(response);\n * // or\n * getItem(\"ae7\", { authentication })\n *   .then(response)\n * ```\n * Get an item by id. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/item.htm) for more information.\n *\n * @param id - Item Id\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function getItem(\n  id: string,\n  requestOptions?: IRequestOptions\n): Promise<IItem> {\n  const url = getItemBaseUrl(id, requestOptions);\n\n  // default to a GET request\n  const options: IRequestOptions = {\n    ...{ httpMethod: \"GET\" },\n    ...requestOptions\n  };\n  return request(url, options);\n}\n\n/**\n * Get the fully qualified base URL to the REST end point for an item.\n * @param id Item Id\n * @param portalUrlOrRequestOptions a portal URL or request options\n * @returns URL to the item's REST end point, defaults to `https://www.arcgis.com/sharing/rest/content/items/{id}`\n */\nexport const getItemBaseUrl = (\n  id: string,\n  portalUrlOrRequestOptions?: string | IRequestOptions\n) => {\n  const portalUrl =\n    typeof portalUrlOrRequestOptions === \"string\"\n      ? portalUrlOrRequestOptions\n      : getPortalUrl(portalUrlOrRequestOptions);\n  return `${portalUrl}/content/items/${id}`;\n};\n\n/**\n * ```\n * import { getItemData } from \"@esri/arcgis-rest-portal\";\n * //\n * getItemData(\"ae7\")\n *   .then(response)\n * // or\n * getItemData(\"ae7\", { authentication })\n *   .then(response)\n * ```\n * Get the /data for an item. If no data exists, returns `undefined`. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/item-data.htm) for more information.\n * @param id - Item Id\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the json data for the item.\n */\nexport function getItemData(\n  id: string,\n  requestOptions?: IItemDataOptions\n): Promise<any> {\n  const url = `${getItemBaseUrl(id, requestOptions)}/data`;\n  // default to a GET request\n  const options: IItemDataOptions = {\n    ...{ httpMethod: \"GET\", params: {} },\n    ...requestOptions\n  };\n\n  if (options.file) {\n    options.params.f = null;\n  }\n\n  return request(url, options).catch(err => {\n    /* if the item doesn't include data, the response will be empty\n       and the internal call to response.json() will fail */\n    const emptyResponseErr = RegExp(\n      /The string did not match the expected pattern|(Unexpected end of (JSON input|data at line 1 column 1))/i\n    );\n    /* istanbul ignore else */\n    if (emptyResponseErr.test(err.message)) {\n      return;\n    } else throw err;\n  });\n}\n\nexport interface IGetRelatedItemsResponse {\n  total: number;\n  relatedItems: IItem[];\n}\n\n/**\n * ```\n * import { getRelatedItems } from \"@esri/arcgis-rest-portal\";\n * //\n * getRelatedItems({\n *   id: \"ae7\",\n *   relationshipType: \"Service2Layer\" // or several [\"Service2Layer\", \"Map2Area\"]\n * })\n *   .then(response)\n * ```\n * Get the related items. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/related-items.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to get some item resources.\n */\nexport function getRelatedItems(\n  requestOptions: IItemRelationshipOptions\n): Promise<IGetRelatedItemsResponse> {\n  const url = `${getItemBaseUrl(\n    requestOptions.id,\n    requestOptions\n  )}/relatedItems`;\n\n  const options: IItemRelationshipOptions = {\n    httpMethod: \"GET\",\n    params: {\n      direction: requestOptions.direction\n    },\n    ...requestOptions\n  };\n\n  if (typeof requestOptions.relationshipType === \"string\") {\n    options.params.relationshipType = requestOptions.relationshipType;\n  } else {\n    options.params.relationshipTypes = requestOptions.relationshipType;\n  }\n\n  delete options.direction;\n  delete options.relationshipType;\n\n  return request(url, options);\n}\n\n/**\n * Get the resources associated with an item\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to get some item resources.\n */\nexport function getItemResources(\n  id: string,\n  requestOptions?: IRequestOptions\n): Promise<any> {\n  const url = `${getItemBaseUrl(id, requestOptions)}/resources`;\n\n  // Mix in num:1000 with any user supplied params\n  // Key thing - we don't want to mutate the passed in requestOptions\n  // as that may be used in other (subsequent) calls in the course\n  // of a long promise chains\n  const options: IRequestOptions = {\n    ...requestOptions\n  };\n  options.params = { num: 1000, ...options.params };\n\n  return request(url, options);\n}\n\nexport interface IGetItemGroupsResponse {\n  admin?: IGroup[];\n  member?: IGroup[];\n  other?: IGroup[];\n}\n\nexport interface IGetItemResourceOptions extends IRequestOptions {\n  /**\n   * Name of the info file, optionally including the folder path\n   */\n  fileName: string;\n  /**\n   * How the fetch response should be read, see:\n   * https://developer.mozilla.org/en-US/docs/Web/API/Body#Methods\n   */\n  readAs?: FetchReadMethodName;\n}\n\n/**\n * ```js\n * import { getItemResource } from \"@esri/arcgis-rest-portal\";\n *\n * // Parses contents as blob by default\n * getItemResource(\"3ef\", { fileName: \"resource.jpg\", ...})\n *  .then(resourceContents => {});\n *\n * // Can override parse method\n * getItemResource(\"3ef\", { fileName: \"resource.json\", readAs: 'json', ...})\n *  .then(resourceContents => {});\n *\n * // Get the response object instead\n * getItemResource(\"3ef\",{ rawResponse: true, fileName: \"resource.json\" })\n *  .then(response => {})\n * ```\n * Fetches an item resource and optionally parses it to the correct format.\n *\n * Note: provides JSON parse error protection by sanitizing out any unescaped control\n * characters before parsing that would otherwise cause an error to be thrown\n *\n * @param {string} itemId\n * @param {IGetItemResourceOptions} requestOptions\n */\nexport function getItemResource(\n  itemId: string,\n  requestOptions: IGetItemResourceOptions\n) {\n  const readAs = requestOptions.readAs || 'blob';\n  return getItemFile(itemId, `/resources/${requestOptions.fileName}`, readAs, requestOptions);\n}\n\n\n/**\n * ```js\n * import { getItemGroups } from \"@esri/arcgis-rest-portal\";\n * //\n * getItemGroups(\"30e5fe3149c34df1ba922e6f5bbf808f\")\n *   .then(response)\n * ```\n * Lists the groups of which the item is a part, only showing the groups that the calling user can access. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/groups.htm) for more information.\n *\n * @param id - The Id of the item to query group association for.\n * @param requestOptions - Options for the request\n * @returns A Promise to get some item groups.\n */\nexport function getItemGroups(\n  id: string,\n  requestOptions?: IRequestOptions\n): Promise<IGetItemGroupsResponse> {\n  const url = `${getItemBaseUrl(id, requestOptions)}/groups`;\n\n  return request(url, requestOptions);\n}\n\nexport interface IItemStatusOptions extends IUserItemOptions {\n  /**\n   * The type of asynchronous job for which the status has to be checked. Default is none, which check the item's status.\n   */\n  jobType?: \"publish\" | \"generateFeatures\" | \"export\" | \"createService\";\n  /**\n   * The job ID returned during publish, generateFeatures, export, and createService calls.\n   */\n  jobId?: string;\n  /**\n   * The response format. The default and the only response format for this resource is HTML.\n   */\n  format?: \"html\";\n}\n\nexport interface IGetItemStatusResponse {\n  status: \"partial\" | \"processing\" | \"failed\" | \"completed\";\n  statusMessage: string;\n  itemId: string;\n}\n\n/**\n * ```js\n * import { getItemStatus } from \"@esri/arcgis-rest-portal\";\n * //\n * getItemStatus({\n *   id: \"30e5fe3149c34df1ba922e6f5bbf808f\",\n *   authentication\n * })\n *   .then(response)\n * ```\n * Inquire about status when publishing an item, adding an item in async mode, or adding with a multipart upload. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/status.htm) for more information.\n *\n * @param id - The Id of the item to get status for.\n * @param requestOptions - Options for the request\n * @returns A Promise to get the item status.\n */\nexport function getItemStatus(\n  requestOptions: IItemStatusOptions\n): Promise<IGetItemStatusResponse> {\n  return determineOwner(requestOptions).then(owner => {\n    const url = `${getPortalUrl(requestOptions)}/content/users/${owner}/items/${\n      requestOptions.id\n    }/status`;\n\n    const options = appendCustomParams<IItemStatusOptions>(\n      requestOptions,\n      [\"jobId\", \"jobType\"],\n      { params: { ...requestOptions.params } }\n    );\n\n    return request(url, options);\n  });\n}\n\nexport interface IGetItemPartsResponse {\n  parts: number[];\n}\n\n/**\n * ```js\n * import { getItemParts } from \"@esri/arcgis-rest-portal\";\n * //\n * getItemParts({\n *   id: \"30e5fe3149c34df1ba922e6f5bbf808f\",\n *   authentication\n * })\n *   .then(response)\n * ```\n * Lists the part numbers of the file parts that have already been uploaded in a multipart file upload. This method can be used to verify the parts that have been received as well as those parts that were not received by the server. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/parts.htm) for more information.\n *\n * @param id - The Id of the item to get part list.\n * @param requestOptions - Options for the request\n * @returns A Promise to get the item part list.\n */\nexport function getItemParts(\n  requestOptions: IUserItemOptions\n): Promise<IGetItemPartsResponse> {\n  return determineOwner(requestOptions).then(owner => {\n    const url = `${getPortalUrl(requestOptions)}/content/users/${owner}/items/${\n      requestOptions.id\n    }/parts`;\n    return request(url, requestOptions);\n  });\n}\n\nexport interface IGetItemInfoOptions extends IRequestOptions {\n  /**\n   * Name of the info file, optionally including the folder path\n   */\n  fileName?: string;\n  /**\n   * How the fetch response should be read, see:\n   * https://developer.mozilla.org/en-US/docs/Web/API/Body#Methods\n   */\n  readAs?: FetchReadMethodName;\n}\n\n/**\n * ```\n * import { getItemInfo } from \"@esri/arcgis-rest-portal\";\n * // get the \"Info Card\" for the item\n * getItemInfo(\"ae7\")\n *   .then(itemInfoXml) // XML document as a string\n * // or get the contents of a specific file\n * getItemInfo(\"ae7\", { fileName: \"form.json\", readAs: \"json\", authentication })\n *   .then(formJson) // JSON document as JSON\n * ```\n * Get an info file for an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/item-info-file.htm) for more information.\n * @param id - Item Id\n * @param requestOptions - Options for the request, including the file name which defaults to `iteminfo.xml`.\n * If the file is not a text file (XML, HTML, etc) you will need to specify the `readAs` parameter\n * @returns A Promise that will resolve with the contents of the info file for the item.\n */\nexport function getItemInfo(\n  id: string,\n  requestOptions?: IGetItemInfoOptions\n): Promise<any> {\n  const { fileName = \"iteminfo.xml\", readAs = \"text\" } = requestOptions || {};\n  const options: IRequestOptions = {\n    httpMethod: \"GET\",\n    ...requestOptions\n  };\n  return getItemFile(id, `/info/${fileName}`, readAs, options);\n}\n\n/**\n * ```\n * import { getItemMetadata } from \"@esri/arcgis-rest-portal\";\n * // get the metadata for the item\n * getItemMetadata(\"ae7\")\n *   .then(itemMetadataXml) // XML document as a string\n * // or with additional request options\n * getItemMetadata(\"ae7\", { authentication })\n *   .then(itemMetadataXml) // XML document as a string\n * ```\n * Get the standard formal metadata XML file for an item (`/info/metadata/metadata.xml`)\n * @param id - Item Id\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the contents of the metadata file for the item as a string.\n */\nexport function getItemMetadata(\n  id: string,\n  requestOptions?: IRequestOptions\n): Promise<any> {\n  const options = {\n    ...requestOptions,\n    fileName: \"metadata/metadata.xml\"\n  } as IGetItemInfoOptions;\n  return getItemInfo(id, options);\n}\n\n// overrides request()'s default behavior for reading the response\n// which is based on `params.f` and defaults to JSON\n// Also adds JSON parse error protection by sanitizing out any unescaped control characters before parsing\nfunction getItemFile(\n  id: string,\n  // NOTE: fileName should include any folder/subfolders\n  fileName: string,\n  readMethod: FetchReadMethodName,\n  requestOptions?: IRequestOptions\n): Promise<any> {\n  const url = `${getItemBaseUrl(id, requestOptions)}${fileName}`;\n  // preserve escape hatch to let the consumer read the response\n  // and ensure the f param is not appended to the query string\n  const options: IRequestOptions = {\n    params: {},\n    ...requestOptions\n  };\n  const justReturnResponse = options.rawResponse;\n  options.rawResponse = true;\n  options.params.f = null;\n\n  return request(url, options).then(response => {\n    if (justReturnResponse) {\n      return response;\n    }\n    return readMethod !== 'json'\n      ? response[readMethod]()\n      : response.text().then((text: string) => JSON.parse(scrubControlChars(text)));\n  });\n}\n","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport {\n  request,\n  IRequestOptions,\n  appendCustomParams\n} from \"@esri/arcgis-rest-request\";\nimport { IPagingParams, IGroup, IItem, IUser } from \"@esri/arcgis-rest-types\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\n\nexport interface IGroupCategorySchema {\n  categorySchema: IGroupCategory[];\n}\n\nexport interface IGroupCategory {\n  title: string;\n  description?: string;\n  categories?: IGroupCategory[];\n}\n\nexport interface IGetGroupContentOptions extends IRequestOptions {\n  paging: IPagingParams;\n}\n\nexport interface IGroupContentResult {\n  total: number;\n  start: number;\n  num: number;\n  nextStart: number;\n  items: IItem[];\n}\n\nexport interface IGroupUsersResult {\n  owner: string;\n  admins: string[];\n  users: string[];\n}\n\n/**\n * ```js\n * import { getGroup } from \"@esri/arcgis-rest-portal\";\n * //\n * getGroup(\"fxb988\") // id\n *   .then(response)\n * ```\n * Fetch a group using its id. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/group.htm) for more information.\n *\n * @param id - Group Id\n * @param requestOptions  - Options for the request\n * @returns  A Promise that will resolve with the data from the response.\n */\nexport function getGroup(\n  id: string,\n  requestOptions?: IRequestOptions\n): Promise<IGroup> {\n  const url = `${getPortalUrl(requestOptions)}/community/groups/${id}`;\n  // default to a GET request\n  const options: IRequestOptions = {\n    ...{ httpMethod: \"GET\" },\n    ...requestOptions\n  };\n  return request(url, options);\n}\n\n/**\n * Gets the category schema set on a group\n *\n * @param id - Group Id\n * @param requestOptions  - Options for the request\n * @returns A promise that will resolve with JSON of group's category schema\n * @see https://developers.arcgis.com/rest/users-groups-and-items/group-category-schema.htm\n */\nexport function getGroupCategorySchema(\n  id: string,\n  requestOptions?: IRequestOptions\n): Promise<IGroupCategorySchema> {\n  const url = `${getPortalUrl(\n    requestOptions\n  )}/community/groups/${id}/categorySchema`;\n\n  // default to a GET request\n  const options: IRequestOptions = {\n    ...{ httpMethod: \"GET\" },\n    ...requestOptions\n  };\n  return request(url, options);\n}\n\n/**\n * Returns the content of a Group. Since the group may contain 1000s of items\n * the requestParams allow for paging.\n * @param id - Group Id\n * @param requestOptions  - Options for the request, including paging parameters.\n * @returns  A Promise that will resolve with the content of the group.\n */\nexport function getGroupContent(\n  id: string,\n  requestOptions?: IGetGroupContentOptions\n): Promise<IGroup> {\n  const url = `${getPortalUrl(requestOptions)}/content/groups/${id}`;\n\n  // default to a GET request\n  const options: IRequestOptions = {\n    ...{ httpMethod: \"GET\" },\n    params: { start: 1, num: 100 },\n    ...requestOptions\n  } as IGetGroupContentOptions;\n\n  // is this the most concise way to mixin with the defaults above?\n  if (requestOptions && requestOptions.paging) {\n    options.params = { ...requestOptions.paging };\n  }\n\n  return request(url, options);\n}\n\n/**\n * Get the usernames of the admins and members. Does not return actual 'User' objects. Those must be\n * retrieved via separate calls to the User's API.\n * @param id - Group Id\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with arrays of the group admin usernames and the member usernames\n */\nexport function getGroupUsers(\n  id: string,\n  requestOptions?: IRequestOptions\n): Promise<IGroupUsersResult> {\n  const url = `${getPortalUrl(requestOptions)}/community/groups/${id}/users`;\n  // default to a GET request\n  const options: IRequestOptions = {\n    ...{ httpMethod: \"GET\" },\n    ...requestOptions\n  };\n  return request(url, options);\n}\n\nexport interface ISearchGroupUsersOptions\n  extends IRequestOptions,\n    IPagingParams {\n  name?: string;\n  sortField?: string;\n  sortOrder?: string;\n  joined?: number | number[];\n  memberType?: string;\n  [key: string]: any;\n}\n\nexport interface ISearchGroupUsersResult {\n  total: number;\n  start: number;\n  num: number;\n  nextStart: number;\n  owner: IUser;\n  users: any[];\n}\n\n/**\n * ```js\n * import { searchGroupUsers } from \"@esri/arcgis-rest-portal\";\n * //\n * searchGroupUsers('abc123')\n *   .then(response)\n * ```\n * Search the users in a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/group-users-list.htm) for more information.\n *\n * @param id - The group id\n * @param searchOptions - Options for the request, including paging parameters.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function searchGroupUsers(\n  id: string,\n  searchOptions?: ISearchGroupUsersOptions\n): Promise<ISearchGroupUsersResult> {\n  const url = `${getPortalUrl(searchOptions)}/community/groups/${id}/userlist`;\n  const options = appendCustomParams<ISearchGroupUsersOptions>(\n    searchOptions || {},\n    [\"name\", \"num\", \"start\", \"sortField\", \"sortOrder\", \"joined\", \"memberType\"],\n    {\n      httpMethod: \"GET\"\n    }\n  );\n  return request(url, options);\n}\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { IGroup, IUser, GroupMembership } from \"@esri/arcgis-rest-types\";\nimport { IUserRequestOptions } from \"@esri/arcgis-rest-auth\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { getGroup } from \"../groups/get\";\n\nexport interface ISharingOptions extends IUserRequestOptions {\n  /**\n   * Unique identifier for the item.\n   */\n  id: string;\n  /**\n   * Item owner, if different from the authenticated user.\n   */\n  owner?: string;\n}\n\nexport interface ISharingResponse {\n  notSharedWith?: string[];\n  notUnsharedFrom?: string[];\n  itemId: string;\n}\n\nexport function getSharingUrl(requestOptions: ISharingOptions): string {\n  const username = requestOptions.authentication.username;\n  const owner = requestOptions.owner || username;\n  return `${getPortalUrl(requestOptions)}/content/users/${encodeURIComponent(\n    owner\n  )}/items/${requestOptions.id}/share`;\n}\n\nexport function isItemOwner(requestOptions: ISharingOptions): boolean {\n  const username = requestOptions.authentication.username;\n  const owner = requestOptions.owner || username;\n  return owner === username;\n}\n\n/**\n * Check it the user is a full org_admin\n * @param requestOptions\n * @returns Promise resolving in a boolean indicating if the user is an ArcGIS Organization administrator\n */\nexport function isOrgAdmin(\n  requestOptions: IUserRequestOptions\n): Promise<boolean> {\n  const session = requestOptions.authentication;\n\n  return session.getUser(requestOptions).then((user: IUser) => {\n      return user && user.role === \"org_admin\" && !user.roleId;\n  });\n}\n\n/**\n * Get the User Membership for a particular group. Use this if all you have is the groupId.\n * If you have the group object, check the `userMembership.memberType` property instead of calling this method.\n *\n * @param requestOptions\n * @returns A Promise that resolves with \"owner\" | \"admin\" | \"member\" | \"nonmember\"\n */\nexport function getUserMembership(\n  requestOptions: IGroupSharingOptions\n): Promise<GroupMembership> {\n  // fetch the group...\n  return getGroup(requestOptions.groupId, requestOptions)\n    .then((group: IGroup) => {\n      return group.userMembership.memberType;\n    })\n    .catch(() => {\n      return \"none\" as GroupMembership;\n    });\n}\n\nexport interface IGroupSharingOptions extends ISharingOptions {\n  /**\n   * Group identifier\n   */\n  groupId: string;\n  confirmItemControl?: boolean;\n}\n","import { IParamBuilder, warn } from \"@esri/arcgis-rest-request\";\n/**\n * `SearchQueryBuilder` can be used to construct the `q` param for [`searchItems`](/arcgis-rest-js/api/portal/searchItems#searchItems-search) or [`searchGroups`](/arcgis-rest-js/api/portal/searchGroups#searchGroups-search). By chaining methods, it helps build complex search queries.\n *\n * ```js\n * const query = new SearchQueryBuilder()\n *  .match(\"Patrick\")\n *  .in(\"owner\")\n *  .and()\n *  .startGroup()\n *    .match(\"Web Mapping Application\")\n *    .in(\"type\")\n *    .or()\n *    .match(\"Mobile Application\")\n *    .in(\"type\")\n *    .or()\n *    .match(\"Application\")\n *    .in(\"type\")\n *  .endGroup()\n *  .and()\n *  .match(\"Demo App\");\n *\n * searchItems(query).then((res) => {\n *   console.log(res.results);\n * });\n * ```\n *\n * Will search for items matching\n * ```\n * \"owner: Patrick AND (type:\"Web Mapping Application\" OR type:\"Mobile Application\" OR type:Application) AND Demo App\"\n * ```\n */\nexport class SearchQueryBuilder implements IParamBuilder {\n  private termStack: any[] = [];\n  private rangeStack: any[] = [];\n  private q: string;\n  private openGroups = 0;\n  private currentModifer: string;\n\n  /**\n   * @param q An existing query string to start building from.\n   */\n  constructor(q: string = \"\") {\n    this.q = q;\n  }\n\n  /**\n   * Defines strings to search for.\n   *\n   * ```js\n   * const query = new SearchQueryBuilder()\n   *   .match(\"My Layer\")\n   * ```\n   *\n   * @param terms strings to search for.\n   */\n  public match(this: SearchQueryBuilder, ...terms: string[]) {\n    this.termStack = this.termStack.concat(terms);\n    return this;\n  }\n\n  /**\n   * Defines fields to search in. You can pass `\"*\"` or call this method without arguments to search a default set of fields\n   *\n   * ```js\n   * const query = new SearchQueryBuilder()\n   *   .match(\"My Layer\")\n   *   .in(\"title\")\n   * ```\n   *\n   * @param field The field to search for the previous match in.\n   */\n  public in(this: SearchQueryBuilder, field?: string) {\n    const fn = `\\`in(${field ? `\"${field}\"` : \"\"})\\``;\n\n    if (!this.hasRange && !this.hasTerms) {\n      warn(\n        // prettier-ignore\n        `${fn} was called with no call to \\`match(...)\\` or \\`from(...)\\`/\\`to(...)\\`. Your query was not modified.`\n      );\n      return this;\n    }\n\n    if (field && field !== \"*\") {\n      this.q += `${field}:`;\n    }\n\n    return this.commit();\n  }\n\n  /**\n   * Starts a new search group.\n   *\n   * ```js\n   * const query = new SearchQueryBuilder()\n   *   .startGroup()\n   *     .match(\"Lakes\")\n   *     .in(\"title\")\n   *   .endGroup()\n   *   .or()\n   *   .startGroup()\n   *     .match(\"Rivers\")\n   *     .in(\"title\")\n   *   .endGroup()\n   * ```\n   */\n  public startGroup(this: SearchQueryBuilder) {\n    this.commit();\n    if (this.openGroups > 0) {\n      this.q += \" \";\n    }\n    this.openGroups++;\n    this.q += \"(\";\n    return this;\n  }\n\n  /**\n   * Ends a search group.\n   *\n   * ```js\n   * const query = new SearchQueryBuilder()\n   *   .startGroup()\n   *     .match(\"Lakes\")\n   *     .in(\"title\")\n   *   .endGroup()\n   *   .or()\n   *   .startGroup()\n   *     .match(\"Rivers\")\n   *     .in(\"title\")\n   *   .endGroup()\n   * ```\n   */\n  public endGroup(this: SearchQueryBuilder) {\n    if (this.openGroups <= 0) {\n      warn(\n        `\\`endGroup(...)\\` was called without calling \\`startGroup(...)\\` first. Your query was not modified.`\n      );\n      return this;\n    }\n    this.commit();\n    this.openGroups--;\n    this.q += \")\";\n    return this;\n  }\n\n  /**\n   * Joins two sets of queries with an `AND` clause.\n   *\n   * ```js\n   * const query = new SearchQueryBuilder()\n   *   .match(\"Lakes\")\n   *   .in(\"title\")\n   *   .and()\n   *   .match(\"Rivers\")\n   *   .in(\"title\")\n   * ```\n   */\n  public and(this: SearchQueryBuilder) {\n    return this.addModifier(\"and\");\n  }\n\n  /**\n   * Joins two sets of queries with an `OR` clause.\n   *\n   * ```js\n   * const query = new SearchQueryBuilder()\n   *   .match(\"Lakes\")\n   *   .in(\"title\")\n   *   .or()\n   *   .match(\"Rivers\")\n   *   .in(\"title\")\n   * ```\n   */\n  public or(this: SearchQueryBuilder) {\n    return this.addModifier(\"or\");\n  }\n\n  /**\n   * Joins two sets of queries with a `NOT` clause. Another option for filtering results is the [prohibit operator '-'](https://developers.arcgis.com/rest/users-groups-and-items/search-reference.htm#ESRI_SECTION1_5C6C35DB9E4A4F4492C5B937BDA2BF67).\n   *\n   * ```js\n   * // omit results with \"Rivers\" in their title\n   * const query = new SearchQueryBuilder()\n   *   .not()\n   *   .match(\"Rivers\")\n   *   .in(\"title\")\n   *\n   * // equivalent\n   * const query = new SearchQueryBuilder()\n   *   .match(\"Rivers\")\n   *   .in(\"-title\")\n   * ```\n   */\n  public not(this: SearchQueryBuilder) {\n    return this.addModifier(\"not\");\n  }\n\n  /**\n   * Begins a new range query.\n   *\n   * ```js\n   * const query = new SearchQueryBuilder()\n   *   .from(yesterdaysDate)\n   *   .to(todaysDate)\n   *   .in(\"created\")\n   * ```\n   */\n  public from(this: SearchQueryBuilder, term: number | string | Date) {\n    if (this.hasTerms) {\n      warn(\n        // prettier-ignore\n        `\\`from(...)\\` is not allowed after \\`match(...)\\` try using \\`.from(...).to(...).in(...)\\`. Your query was not modified.`\n      );\n      return this;\n    }\n    this.rangeStack[0] = term;\n    return this;\n  }\n\n  /**\n   * Ends a range query.\n   *\n   * ```js\n   * const query = new SearchQueryBuilder()\n   *   .from(yesterdaysDate)\n   *   .to(todaysDate)\n   *   .in(\"created\")\n   * ```\n   */\n  public to(this: SearchQueryBuilder, term: any) {\n    if (this.hasTerms) {\n      warn(\n        // prettier-ignore\n        `\\`to(...)\\` is not allowed after \\`match(...)\\` try using \\`.from(...).to(...).in(...)\\`. Your query was not modified.`\n      );\n      return this;\n    }\n    this.rangeStack[1] = term;\n    return this;\n  }\n\n  /**\n   * Boosts the previous term to increase its rank in the results.\n   *\n   * ```js\n   * const query = new SearchQueryBuilder()\n   *   .match(\"Lakes\")\n   *   .in(\"title\")\n   *   .or()\n   *   .match(\"Rivers\")\n   *   .in(\"title\")\n   *   .boost(3)\n   * ```\n   */\n  public boost(this: SearchQueryBuilder, num: number) {\n    this.commit();\n    this.q += `^${num}`;\n    return this;\n  }\n\n  /**\n   * Returns the current query string. Called internally when the request is made.\n   */\n  public toParam() {\n    this.commit();\n    this.cleanup();\n    return this.q;\n  }\n\n  /**\n   * Returns a new instance of `SearchQueryBuilder` based on the current instance.\n   */\n  public clone() {\n    this.commit();\n    this.cleanup();\n    return new SearchQueryBuilder(this.q + \"\");\n  }\n\n  private addModifier(modifier: string) {\n    if (this.currentModifer) {\n      warn(\n        // prettier-ignore\n        `You have called \\`${this.currentModifer}()\\` after \\`${modifier}()\\`. Your current query was not modified.`\n      );\n      return this;\n    }\n\n    this.commit();\n\n    if (this.q === \"\" && modifier !== \"not\") {\n      warn(\n        `You have called \\`${modifier}()\\` without calling another method to modify your query first. Try calling \\`match()\\` first.`\n      );\n      return this;\n    }\n\n    this.currentModifer = modifier;\n    this.q += this.q === \"\" ? \"\" : \" \";\n    this.q += `${modifier.toUpperCase()} `;\n    return this;\n  }\n\n  private hasWhiteSpace(s: string) {\n    return /\\s/g.test(s);\n  }\n\n  private formatTerm(term: any) {\n    if (term instanceof Date) {\n      return term.getTime();\n    }\n\n    if (typeof term === \"string\" && this.hasWhiteSpace(term)) {\n      return `\"${term}\"`;\n    }\n\n    return term;\n  }\n\n  private commit() {\n    this.currentModifer = undefined;\n    if (this.hasRange) {\n      this.q += `[${this.formatTerm(this.rangeStack[0])} TO ${this.formatTerm(\n        this.rangeStack[1]\n      )}]`;\n      this.rangeStack = [undefined, undefined];\n    }\n\n    if (this.hasTerms) {\n      this.q += this.termStack\n        .map(term => {\n          return this.formatTerm(term);\n        })\n        .join(\" \");\n      this.termStack = [];\n    }\n\n    return this;\n  }\n\n  private get hasTerms() {\n    return this.termStack.length > 0;\n  }\n\n  private get hasRange() {\n    return this.rangeStack.length && this.rangeStack[0] && this.rangeStack[1];\n  }\n\n  private cleanup() {\n    // end a group if we have started one\n    if (this.openGroups > 0) {\n      warn(\n        // prettier-ignore\n        `Automatically closing ${this.openGroups} group(s). You can use \\`endGroup(...)\\` to remove this warning.`\n      );\n\n      while (this.openGroups > 0) {\n        this.q += \")\";\n        this.openGroups--;\n      }\n    }\n\n    const oldQ = this.q;\n    this.q = oldQ.replace(/( AND ?| NOT ?| OR ?)*$/, \"\");\n\n    if (oldQ !== this.q) {\n      warn(\n        `\\`startGroup(...)\\` was called without calling \\`endGroup(...)\\` first. Your query was not modified.`\n      );\n    }\n\n    // clear empty groups\n    this.q = this.q.replace(/(\\(\\))*/, \"\");\n  }\n}\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport {\n  request,\n  IRequestOptions,\n  appendCustomParams\n} from \"@esri/arcgis-rest-request\";\nimport { IItem, IGroup, IUser } from \"@esri/arcgis-rest-types\";\n\nimport { SearchQueryBuilder } from \"./SearchQueryBuilder\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport {\n  ISearchOptions,\n  ISearchGroupContentOptions,\n  ISearchResult\n} from \"../util/search\";\n\nexport function genericSearch<T extends IItem | IGroup | IUser>(\n  search:\n    | string\n    | ISearchOptions\n    | ISearchGroupContentOptions\n    | SearchQueryBuilder,\n  searchType: \"item\" | \"group\" | \"groupContent\" | \"user\"\n): Promise<ISearchResult<T>> {\n  let url: string;\n  let options: IRequestOptions;\n  if (typeof search === \"string\" || search instanceof SearchQueryBuilder) {\n    options = {\n      httpMethod: \"GET\",\n      params: {\n        q: search\n      }\n    };\n  } else {\n    options = appendCustomParams<ISearchOptions>(\n      search,\n      [\"q\", \"num\", \"start\", \"sortField\", \"sortOrder\"],\n      {\n        httpMethod: \"GET\"\n      }\n    );\n  }\n\n  let path;\n  switch (searchType) {\n    case \"item\":\n      path = \"/search\";\n      break;\n    case \"group\":\n      path = \"/community/groups\";\n      break;\n    case \"groupContent\":\n      // Need to have groupId property to do group contents search,\n      // cso filter out all but ISearchGroupContentOptions\n      if (\n        typeof search !== \"string\" &&\n        !(search instanceof SearchQueryBuilder) &&\n        search.groupId\n      ) {\n        path = `/content/groups/${search.groupId}/search`;\n      } else {\n        return Promise.reject(new Error(\"you must pass a `groupId` option to `searchGroupContent`\"));\n      }\n      break;\n    default:\n      // \"users\"\n      path = \"/portals/self/users/search\";\n      break;\n  }\n  url = getPortalUrl(options) + path;\n\n  // send the request\n  return request(url, options).then(r => {\n    if (r.nextStart && r.nextStart !== -1) {\n      r.nextPage = function() {\n        let newOptions: ISearchOptions;\n\n        if (\n          typeof search === \"string\" ||\n          search instanceof SearchQueryBuilder\n        ) {\n          newOptions = {\n            q: search,\n            start: r.nextStart\n          };\n        } else {\n          newOptions = search;\n          newOptions.start = r.nextStart;\n        }\n\n        return genericSearch<T>(newOptions, searchType);\n      };\n    }\n\n    return r;\n  });\n}\n","/* Copyright (c) 2018-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { IItem } from \"@esri/arcgis-rest-types\";\nimport { SearchQueryBuilder } from \"../util/SearchQueryBuilder\";\nimport { ISearchOptions, ISearchResult } from \"../util/search\";\nimport { genericSearch } from \"../util/generic-search\";\n\n/**\n * ```js\n * import { searchItems } from \"@esri/arcgis-rest-portal\";\n * //\n * searchItems('water')\n *   .then(response) // response.total => 355\n * ```\n * Search a portal for items. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/search.htm) for more information.\n *\n * @param search - A string or RequestOptions object to pass through to the endpoint.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function searchItems(\n  search: string | ISearchOptions | SearchQueryBuilder\n): Promise<ISearchResult<IItem>> {\n  return genericSearch<IItem>(search, \"item\");\n}\n","/* Copyright (c) 2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nexport function chunk<T>(array: T[], size: number) {\n  if (array.length === 0) {\n    return [];\n  }\n\n  const chunks = [];\n\n  for (let i = 0; i < array.length; i += size) {\n    chunks.push(array.slice(i, i + size));\n  }\n\n  return chunks;\n}\n","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport {\n  request,\n  IRequestOptions,\n  ArcGISRequestError\n} from \"@esri/arcgis-rest-request\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { chunk } from \"../util/array\";\n\nexport interface IAddGroupUsersOptions extends IRequestOptions {\n  /**\n   * Group ID\n   */\n  id: string;\n  /**\n   * An array of usernames to be added to the group as group members\n   */\n  users?: string[];\n  /**\n   * An array of usernames to be added to the group as group admins\n   */\n  admins?: string[];\n}\n\nexport interface IAddGroupUsersResult {\n  /**\n   * An array of usernames that were not added\n   */\n  notAdded?: string[];\n  /**\n   * An array of request errors\n   */\n  errors?: ArcGISRequestError[];\n}\n\n/**\n * ```js\n * import { addGroupUsers } from \"@esri/arcgis-rest-portal\";\n * //\n * addGroupUsers({\n *   id: groupId,\n *   users: [\"username1\", \"username2\"],\n *   admins: [\"username3\"],\n *   authentication\n * })\n * .then(response);\n * ```\n * Add users to a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/add-users-to-group.htm) for more information.\n *\n * @param requestOptions  - Options for the request\n * @returns A Promise\n */\nexport function addGroupUsers(\n  requestOptions: IAddGroupUsersOptions\n): Promise<IAddGroupUsersResult> {\n  const id = requestOptions.id;\n  const url = `${getPortalUrl(requestOptions)}/community/groups/${id}/addUsers`;\n  const baseOptions = Object.assign({}, requestOptions, {\n    admins: undefined,\n    users: undefined\n  });\n\n  const batchRequestOptions = [\n    ..._prepareRequests(\"users\", requestOptions.users, baseOptions),\n    ..._prepareRequests(\"admins\", requestOptions.admins, baseOptions)\n  ];\n\n  const promises = batchRequestOptions.map(options =>\n    _sendSafeRequest(url, options)\n  );\n\n  return Promise.all(promises).then(_consolidateRequestResults);\n}\n\nfunction _prepareRequests(\n  type: \"admins\" | \"users\",\n  usernames: string[],\n  baseOptions: IAddGroupUsersOptions\n): IAddGroupUsersOptions[] {\n  if (!usernames || usernames.length < 1) {\n    return [];\n  }\n\n  // the ArcGIS REST API only allows to add no more than 25 users per request,\n  // see https://developers.arcgis.com/rest/users-groups-and-items/add-users-to-group.htm\n  const userChunks: string[][] = chunk<string>(usernames, 25);\n\n  return userChunks.map(users =>\n    _generateRequestOptions(type, users, baseOptions)\n  );\n}\n\nfunction _generateRequestOptions(\n  type: \"admins\" | \"users\",\n  usernames: string[],\n  baseOptions: IAddGroupUsersOptions\n) {\n  return Object.assign({}, baseOptions, {\n    [type]: usernames,\n    params: {\n      ...baseOptions.params,\n      [type]: usernames\n    }\n  });\n}\n\n// this request is safe since the request error will be handled\nfunction _sendSafeRequest(\n  url: string,\n  requestOptions: IAddGroupUsersOptions\n): Promise<IAddGroupUsersResult> {\n  return request(url, requestOptions).catch(error => {\n    return {\n      errors: [error]\n    };\n  });\n}\n\nfunction _consolidateRequestResults(\n  results: IAddGroupUsersResult[]\n): IAddGroupUsersResult {\n  const notAdded = results\n    .filter(result => result.notAdded)\n    .reduce((collection, result) => collection.concat(result.notAdded), []);\n\n  const errors = results\n    .filter(result => result.errors)\n    .reduce((collection, result) => collection.concat(result.errors), []);\n\n  const consolidated: IAddGroupUsersResult = { notAdded };\n\n  if (errors.length > 0) {\n    consolidated.errors = errors;\n  }\n\n  return consolidated;\n}\n","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport {\n  request,\n  IRequestOptions,\n  ArcGISRequestError\n} from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { chunk } from \"../util/array\";\n\nexport interface IRemoveGroupUsersOptions extends IRequestOptions {\n  /**\n   * Group ID\n   */\n  id: string;\n  /**\n   * An array of usernames to be removed from the group\n   */\n  users?: string[];\n}\n\nexport interface IRemoveGroupUsersResult {\n  /**\n   * An array of usernames that were not removed\n   */\n  notRemoved?: string[];\n  /**\n   * An array of request errors\n   */\n  errors?: ArcGISRequestError[];\n}\n\n/**\n * ```js\n * import { removeGroupUsers } from \"@esri/arcgis-rest-portal\";\n * //\n * removeGroupUsers({\n *   id: groupId,\n *   users: [\"username1\", \"username2\"],\n *   authentication\n * })\n * .then(response);\n * ```\n * Add users to a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/remove-users-from-group.htm) for more information.\n *\n * @param requestOptions  - Options for the request\n * @returns A Promise\n */\nexport function removeGroupUsers (\n  requestOptions: IRemoveGroupUsersOptions\n): Promise<IRemoveGroupUsersResult> {\n  const { id, users: usersToRemove } = requestOptions;\n  const url = `${getPortalUrl(requestOptions)}/community/groups/${id}/removeUsers`;\n  const safeSend = (users: string[]) => {\n    const options: IRemoveGroupUsersOptions = {\n      ...requestOptions,\n      users,\n      params: { users }\n    };\n    return request(url, options)\n      .catch(error => ({ errors: [error] }));\n  };\n  // the ArcGIS REST API only allows to add no more than 25 users per request,\n  // see https://developers.arcgis.com/rest/users-groups-and-items/remove-users-from-group.htm\n  const promises = chunk(usersToRemove, 25).map(usersChunk => safeSend(usersChunk));\n  return Promise.all(promises)\n    .then(results => {\n      const filtered = (propName: string) => results\n        .filter(result => result[propName])\n        .reduce((collection, result) => collection.concat(result[propName]), []);\n      const errors = filtered('errors');\n      const consolidated: IRemoveGroupUsersResult = { notRemoved: filtered('notRemoved') };\n      return errors.length ? { ...consolidated, errors } : consolidated;\n    });\n}","import {\n  request,\n  IRequestOptions,\n  ArcGISRequestError\n} from \"@esri/arcgis-rest-request\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { chunk } from \"../util/array\";\n\nexport interface IInviteGroupUsersOptions extends IRequestOptions {\n  /**\n   * Group ID\n   */\n  id: string;\n  /**\n   * An array of usernames to be added to the group as group members\n   */\n  users: string[];\n  /**\n   * What role the users should be invited as ('group_member' | 'group_admin')\n   */\n  role: string;\n  /**\n   * Expiration date on the invitation can be set for one day, three days, one week, or two weeks, in minutes.\n   */\n  expiration: number\n}\n\nexport interface IInviteGroupUsersResult {\n  /**\n   * Whether the operation was successful\n   */\n  success: boolean;\n  /**\n   * An array of request errors\n   */\n  errors?: ArcGISRequestError[];\n}\n\n/**\n * Invites users to join a group. Operation success\n * will be indicated by a flag on the return\n * object. If there are any errors, they will be\n * placed in an errors array on the return object\n * \n * ```js\n * const authentication: IAuthenticationManager; // Typically passed into to the function\n * //\n * const options: IInviteGroupUsersOptions = {\n *  id: 'group_id',\n *  users: ['ed', 'edd', 'eddy'],\n *  role: 'group-member',\n *  expiration: 20160,\n *  authentication\n * }\n * //\n * const result = await inviteGroupUsers(options);\n * //\n * const if_success_result_looks_like = {\n *  success: true\n * }\n * //\n * const if_failure_result_looks_like = {\n *  success: false,\n *  errors: [ArcGISRequestError]\n * }\n * ```\n * @param {IInviteGroupUsersOptions} options\n *\n * @returns {Promise<IAddGroupUsersResult>} \n */\nexport function inviteGroupUsers(options: IInviteGroupUsersOptions): Promise<IInviteGroupUsersResult> {\n  const id = options.id;\n  const url = `${getPortalUrl(options)}/community/groups/${id}/invite`;\n  const batches = _generateBatchRequests(options);\n  const promises = batches.map(batch => _sendSafeRequest(url, batch));\n\n  return Promise.all(promises).then(_combineResults);\n}\n\n/**\n * @private\n */\nfunction _generateBatchRequests(options: IInviteGroupUsersOptions) {\n  const userBatches: string[][] = chunk<string>(options.users, 25);\n  return userBatches.map(users => _generateRequestOptions(users, options));\n}\n\n/**\n * @private\n */\nfunction _generateRequestOptions(users: string[], baseOptions: IInviteGroupUsersOptions): IRequestOptions {\n  const requestOptions: IInviteGroupUsersOptions = Object.assign({}, baseOptions);\n\n  requestOptions.params = {\n    ...requestOptions.params,\n    users,\n    role: requestOptions.role,\n    expiration: requestOptions.expiration,\n  }\n  \n  return requestOptions;\n}\n\n/**\n * @private \n */\nfunction _sendSafeRequest(url: string,requestOptions: IRequestOptions): Promise<IInviteGroupUsersResult> {\n  return request(url, requestOptions)\n    .catch(error => ({ errors: [error] }));\n}\n\n/**\n * @private \n */\nfunction _combineResults(responses: IInviteGroupUsersResult[]): IInviteGroupUsersResult {\n  const success = responses.every(res => res.success);\n  const errors: ArcGISRequestError[] = responses.reduce((collection, res) => collection.concat(res.errors || []), []);\n  const combined: IInviteGroupUsersResult = { success };\n\n  if (errors.length > 0) {\n    combined.errors = errors;\n  }\n\n  return combined;\n}\n\n","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { IUserRequestOptions } from \"@esri/arcgis-rest-auth\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { request } from \"@esri/arcgis-rest-request\";\n\nexport interface IUpdateGroupUsersResult {\n  /**\n   * Array of results\n   */\n  results: any[];\n}\n\nexport interface IUpdateGroupUsersOptions extends IUserRequestOptions {\n  /**\n   * Group ID\n   */\n  id: string;\n  /**\n   * An array of usernames to be updated\n   */\n  users: string[];\n  /**\n   * Membership Type to update to\n   */\n  newMemberType: \"member\" | \"admin\";\n}\n\n/**\n * ```js\n * import { updateUserMemberships } from \"@esri/arcgis-rest-portal\";\n * //\n * updateUserMemberships({\n *   id: groupId,\n *   admins: [\"username3\"],\n *   authentication\n * })\n * .then(response);\n * ```\n * Change the user membership levels of existing users in a group\n *\n * @param requestOptions  - Options for the request\n * @returns A Promise\n */\nexport function updateUserMemberships(\n  requestOptions: IUpdateGroupUsersOptions\n): Promise<IUpdateGroupUsersResult> {\n  const url = `${getPortalUrl(requestOptions)}/community/groups/${\n    requestOptions.id\n  }/updateUsers`;\n  const opts: any = {\n    authentication: requestOptions.authentication,\n    params: {}\n  };\n  // add the correct params depending on the type of membership we are changing to\n  if (requestOptions.newMemberType === \"admin\") {\n    opts.params.admins = requestOptions.users;\n  } else {\n    opts.params.users = requestOptions.users;\n  }\n  // make the request\n  return request(url, opts);\n}\n","import {\n  request,\n  IRequestOptions,\n  ArcGISRequestError\n} from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { chunk } from \"../util/array\";\n\nexport interface ICreateOrgNotificationOptions extends IRequestOptions {\n  /**\n   * Subject of the notification. This only applies to email and builtin notifications. For push notifications, subject/title is provided as a part of the message payload.\n   */\n  subject?: string;\n  /**\n   * Message to be sent. For builtin and email notifications this is a string. For push notifications, this will be JSON.\n   */\n  message: string | object;\n  /**\n   * Array of usernames of the users in the group to whom the message should be sent. If not provided, the message will be sent to all users in the group if the user is an admin. Only group admins will be able to send notifications to a list of users. Group users will be able to send notifications to only one user at a time.\n   */\n  users?: string[];\n  /**\n   * The channel through which the notification is to be delivered. Supported values are email or builtin. Email will be sent when the email option is chosen. If the builtin option is chosen, a notification will be added to the notifications list that the user can see when logged into the home app.\n   */\n  notificationChannelType?: string;\n\n  /**\n   * How many emails should be sent at a time. Defaults to the max possible (25)\n   */\n  batchSize?: number\n}\n\nexport interface ICreateOrgNotificationResult {\n  /**\n   * Whether the operation was successful\n   */\n  success: boolean;\n  /**\n   * An array of request errors\n   */\n  errors?: ArcGISRequestError[];\n}\n\n/**\n * Send a notification to members of the requesting user's org.\n * Operation success will be indicated by a flag on the return\n * object. If there are any errors, they will be placed in an \n * errors array on the return object\n * \n * ```js\n * const authentication: IAuthenticationManager; // Typically passed into to the function\n * //\n * const options: IInviteGroupUsersOptions = {\n *  id: 'group_id',\n *  users: ['larry', 'curly', 'moe'],\n *  notificationChannelType: 'email',\n *  expiration: 20160,\n *  authentication\n * }\n * //\n * const result = await createOrgNotification(options);\n * //\n * const if_success_result_looks_like = {\n *  success: true\n * }\n * //\n * const if_failure_result_looks_like = {\n *  success: false,\n *  errors: [ArcGISRequestError]\n * }\n * ```\n * @param {ICreateOrgNotificationOptions} options\n *\n * @returns {ICreateOrgNotificationResult}\n */\nexport function createOrgNotification (options: ICreateOrgNotificationOptions) {\n  const url = `${getPortalUrl(options)}/portals/self/createNotification`;\n  const batches = _generateBatchRequests(options);\n  const promises = batches.map(batch => _sendSafeRequest(url, batch));\n\n  return Promise.all(promises).then(_combineResults);\n}\n\n/**\n * @private\n */\nfunction _generateBatchRequests(options: ICreateOrgNotificationOptions): IRequestOptions[] {\n  const userBatches: string[][] = chunk<string>(options.users, options.batchSize || 25);\n  return userBatches.map(users => _generateRequestOptions(users, options));\n}\n\n/**\n * @private\n */\nfunction _generateRequestOptions(users: string[], baseOptions: ICreateOrgNotificationOptions): IRequestOptions {\n  const requestOptions: ICreateOrgNotificationOptions = Object.assign({}, baseOptions);\n\n  requestOptions.params = {\n    ...requestOptions.params,\n    users,\n    subject: baseOptions.subject,\n    message: baseOptions.message,\n    notificationChannelType: requestOptions.notificationChannelType,\n  }\n  \n  return requestOptions;\n}\n\n/**\n * @private \n */\nfunction _sendSafeRequest(url: string,requestOptions: IRequestOptions): Promise<ICreateOrgNotificationResult> {\n  return request(url, requestOptions)\n    .catch(error => ({ errors: [error] }));\n}\n\n/**\n * @private \n */\nfunction _combineResults(responses: ICreateOrgNotificationResult[]): ICreateOrgNotificationResult {\n  const success = responses.every(res => res.success);\n  const errors: ArcGISRequestError[] = responses.reduce((collection, res) => collection.concat(res.errors || []), []);\n  const combined: ICreateOrgNotificationResult = { success };\n\n  if (errors.length > 0) {\n    combined.errors = errors;\n  }\n\n  return combined;\n}\n\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request, IRequestOptions } from \"@esri/arcgis-rest-request\";\nimport { IUser } from \"@esri/arcgis-rest-types\";\n\nimport { UserSession } from \"@esri/arcgis-rest-auth\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\n\nexport interface IGetUserOptions extends IRequestOptions {\n  /**\n   * A session representing a logged in user.\n   */\n  authentication?: UserSession;\n  /**\n   * Supply a username if you'd like to fetch information about a different user than is being used to authenticate the request.\n   */\n  username?: string;\n}\n\n/**\n * ```js\n * import { getUser } from '@esri/arcgis-rest-portal';\n * //\n * getUser(\"jsmith\")\n *   .then(response)\n * // => { firstName: \"John\", lastName: \"Smith\",tags: [\"GIS Analyst\", \"City of Redlands\"] }\n * ```\n * Get information about a user. This method has proven so generically useful that you can also call [`UserSession.getUser()`](/arcgis-rest-js/api/auth/UserSession#getUser-summary).\n *\n * @param requestOptions - options to pass through in the request\n * @returns A Promise that will resolve with metadata about the user\n */\nexport function getUser(\n  requestOptions?: string | IGetUserOptions\n): Promise<IUser> {\n  let url;\n  let options = { httpMethod: \"GET\" } as IGetUserOptions;\n\n  // if a username is passed, assume ArcGIS Online\n  if (typeof requestOptions === \"string\") {\n    url = `https://www.arcgis.com/sharing/rest/community/users/${requestOptions}`;\n  } else {\n    // if an authenticated session is passed, default to that user/portal unless another username is provided manually\n    const username =\n      requestOptions.username || requestOptions.authentication.username;\n    url = `${getPortalUrl(requestOptions)}/community/users/${encodeURIComponent(\n      username\n    )}`;\n    options = {\n      ...requestOptions,\n      ...options\n    };\n  }\n  // send the request\n  return request(url, options);\n}\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request } from \"@esri/arcgis-rest-request\";\n\nimport {\n  ISharingOptions,\n  ISharingResponse,\n  isItemOwner,\n  getSharingUrl,\n  isOrgAdmin\n} from \"./helpers\";\n\nexport interface ISetAccessOptions extends ISharingOptions {\n  /**\n   * \"private\" indicates that the item can only be accessed by the user. \"public\" means accessible to anyone. An item shared to the organization has an access level of \"org\".\n   */\n  access: \"private\" | \"org\" | \"public\";\n}\n\n/**\n * ```js\n * import { setItemAccess } from \"@esri/arcgis-rest-portal\";\n * //\n * setItemAccess({\n *   id: \"abc123\",\n *   access: \"public\", // 'org' || 'private'\n *   authentication: session\n * })\n * ```\n * Change who is able to access an item.\n *\n * @param requestOptions - Options for the request.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function setItemAccess(\n  requestOptions: ISetAccessOptions\n): Promise<ISharingResponse> {\n  const url = getSharingUrl(requestOptions);\n\n  if (isItemOwner(requestOptions)) {\n    // if the user owns the item, proceed\n    return updateItemAccess(url, requestOptions);\n  } else {\n    // otherwise we need to check to see if they are an organization admin\n    return isOrgAdmin(requestOptions).then(admin => {\n      if (admin) {\n        return updateItemAccess(url, requestOptions);\n      } else {\n        // if neither, updating the sharing isnt possible\n        throw Error(\n          `This item can not be shared by ${requestOptions.authentication.username}. They are neither the item owner nor an organization admin.`\n        );\n      }\n    });\n  }\n}\n\nfunction updateItemAccess(\n  url: string,\n  requestOptions: ISetAccessOptions\n): Promise<any> {\n  requestOptions.params = {\n    org: false,\n    everyone: false,\n    ...requestOptions.params\n  };\n\n  // if the user wants to make the item private, it needs to be unshared from any/all groups as well\n  if (requestOptions.access === \"private\") {\n    requestOptions.params.groups = \" \";\n  }\n  if (requestOptions.access === \"org\") {\n    requestOptions.params.org = true;\n  }\n  // if sharing with everyone, share with the entire organization as well.\n  if (requestOptions.access === \"public\") {\n    // this is how the ArcGIS Online Home app sets public access\n    // setting org = true instead of account = true will cancel out all sharing\n    requestOptions.params.account = true;\n    requestOptions.params.everyone = true;\n  }\n  return request(url, requestOptions);\n}\n","import { IGroupSharingOptions } from \"./helpers\";\nimport { searchItems } from \"../items/search\";\nimport { ISearchOptions } from \"../util/search\";\n\n/**\n * ```js\n * import { isItemSharedWithGroup } from \"@esri/arcgis-rest-portal\";\n * //\n * isItemSharedWithGroup({\n *   groupId: 'bc3,\n *   itemId: 'f56,\n *   authentication\n * })\n * .then(isShared => {})\n * ```\n * Find out whether or not an item is already shared with a group.\n *\n * @param requestOptions - Options for the request. NOTE: `rawResponse` is not supported by this operation.\n * @returns Promise that will resolve with true/false\n */\nexport function isItemSharedWithGroup(\n  requestOptions: IGroupSharingOptions\n): Promise<boolean> {\n  const searchOpts = {\n    q: `id: ${requestOptions.id} AND group: ${requestOptions.groupId}`,\n    start: 1,\n    num: 10,\n    sortField: \"title\",\n    authentication: requestOptions.authentication,\n    httpMethod: \"POST\"\n  } as ISearchOptions;\n\n  return searchItems(searchOpts).then(searchResponse => {\n    let result = false;\n    if (searchResponse.total > 0) {\n      result = searchResponse.results.some((itm: any) => {\n        return itm.id === requestOptions.id;\n      });\n      return result;\n    }\n  });\n}\n","import { request } from \"@esri/arcgis-rest-request\";\nimport { IUser } from \"@esri/arcgis-rest-types\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport {\n  IGroupSharingOptions,\n  ISharingResponse,\n  getUserMembership\n} from \"./helpers\";\nimport { getUser } from \"../users/get-user\";\nimport { addGroupUsers, IAddGroupUsersResult } from \"../groups/add-users\";\nimport { removeGroupUsers } from \"../groups/remove-users\";\nimport { updateUserMemberships, IUpdateGroupUsersResult } from \"../groups/update-user-membership\";\nimport { isItemSharedWithGroup } from \"../sharing/is-item-shared-with-group\";\n\ninterface IEnsureMembershipResult {\n  promise: Promise<IAddGroupUsersResult>,\n  revert: (sharingResults: ISharingResponse) => Promise<ISharingResponse>\n}\n\n/**\n * ```js\n * import { shareItemWithGroup } from '@esri/arcgis-rest-portal';\n * //\n * shareItemWithGroup({\n *   id: \"abc123\",\n *   groupId: \"xyz987\",\n *   owner: \"some-owner\",\n *   authentication\n * })\n * ```\n * Share an item with a group, either as an\n * [item owner](https://developers.arcgis.com/rest/users-groups-and-items/share-item-as-item-owner-.htm),\n * [group admin](https://developers.arcgis.com/rest/users-groups-and-items/share-item-as-group-admin-.htm) or\n * organization admin.\n *\n * @param requestOptions - Options for the request.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function shareItemWithGroup (\n  requestOptions: IGroupSharingOptions\n): Promise<ISharingResponse> {\n  return isItemSharedWithGroup(requestOptions)\n    .then((isShared) => {\n      if (isShared) {\n        // already shared, exit early with success response\n        return {\n          itemId: requestOptions.id,\n          shortcut: true,\n          notSharedWith: []\n        } as ISharingResponse;\n      }\n\n      const {\n        authentication: { username },\n        owner,\n        confirmItemControl\n      } = requestOptions;\n      const itemOwner = owner || username;\n\n      // non-item owner\n      if (itemOwner !== username) {\n        // next perform any necessary membership adjustments for\n        // current user and/or item owner\n        return Promise.all([\n          getUser({\n            username,\n            authentication: requestOptions.authentication\n          }),\n          getUser({\n            username: itemOwner,\n            authentication: requestOptions.authentication\n          }),\n          getUserMembership(requestOptions)\n        ])\n          .then(([currentUser, ownerUser, membership]) => {\n            const isSharedEditingGroup = !!confirmItemControl;\n            const isAdmin = currentUser.role === \"org_admin\" && !currentUser.roleId;\n            return getMembershipAdjustments(\n              currentUser,\n              isSharedEditingGroup,\n              membership,\n              isAdmin,\n              ownerUser,\n              requestOptions\n            );\n          })\n          .then(membershipAdjustments => {\n            const [\n              { revert } = {\n                promise: Promise.resolve({ notAdded: [] }),\n                revert: (sharingResults: ISharingResponse) => {\n                  return Promise.resolve(sharingResults);\n                }\n              } as IEnsureMembershipResult\n            ] = membershipAdjustments;\n            // perform all membership adjustments\n            return Promise.all(membershipAdjustments.map(({ promise }) => promise))\n              .then(() => {\n                // then attempt the share\n                return shareToGroup(requestOptions);\n              })\n              .then(sharingResults => {\n                // lastly, if the admin user was added to the group,\n                // remove them from the group. this is a no-op that\n                // immediately resolves the sharingResults when no\n                // membership adjustment was needed\n                return revert(sharingResults);\n              });\n          });\n      }\n\n      // item owner, let it call through\n      return shareToGroup(requestOptions);\n    })\n    .then(sharingResponse => {\n      if (sharingResponse.notSharedWith.length) {\n        throw Error(\n          `Item ${requestOptions.id} could not be shared to group ${requestOptions.groupId}.`\n        );\n      } else {\n        // all is well\n        return sharingResponse;\n      }\n    });\n}\n\nfunction getMembershipAdjustments (\n  currentUser: IUser,\n  isSharedEditingGroup: boolean,\n  membership: string,\n  isAdmin: boolean,\n  ownerUser: IUser,\n  requestOptions: IGroupSharingOptions\n) {\n  const membershipGuarantees = [];\n  if (requestOptions.groupId !== currentUser.favGroupId) {\n    if (isSharedEditingGroup) {\n      if (!isAdmin) {\n        // abort and reject promise\n        throw Error(`This item can not be shared to shared editing group ${requestOptions.groupId} by ${currentUser.username} as they not the item owner or org admin.`);\n      }\n\n      membershipGuarantees.push(\n        // admin user must be a group member to share, should be reverted afterwards\n        ensureMembership(\n          currentUser,\n          currentUser,\n          false,\n          `Error adding ${currentUser.username} as member to edit group ${requestOptions.groupId}. Consequently item ${requestOptions.id} was not shared to the group.`,\n          requestOptions\n        ),\n        // item owner must be a group admin\n        ensureMembership(\n          currentUser,\n          ownerUser,\n          true,\n          membership === \"none\"\n            ? `Error adding user ${ownerUser.username} to edit group ${requestOptions.groupId}. Consequently item ${requestOptions.id} was not shared to the group.`\n            : `Error promoting user ${ownerUser.username} to admin in edit group ${requestOptions.groupId}. Consequently item ${requestOptions.id} was not shared to the group.`,\n          requestOptions\n        )\n      );\n    } else if (isAdmin) {\n      // admin user must be a group member to share, should be reverted afterwards\n      membershipGuarantees.push(\n        ensureMembership(\n          currentUser,\n          currentUser,\n          false,\n          `Error adding ${currentUser.username} as member to view group ${requestOptions.groupId}. Consequently item ${requestOptions.id} was not shared to the group.`,\n          requestOptions\n        )\n      );\n    } else if (membership === \"none\") {\n      // all other non-item owners must be a group member\n      throw new Error(`This item can not be shared by ${currentUser.username} as they are not a member of the specified group ${requestOptions.groupId}.`);\n    }\n  }\n\n  return membershipGuarantees;\n}\n\nfunction shareToGroup (\n  requestOptions: IGroupSharingOptions\n): Promise<ISharingResponse> {\n  const username = requestOptions.authentication.username;\n  const itemOwner = requestOptions.owner || username;\n  // decide what url to use\n  // default to the non-owner url...\n  let url = `${getPortalUrl(requestOptions)}/content/items/${requestOptions.id}/share`;\n\n  // but if they are the owner, we use a different path...\n  if (itemOwner === username) {\n    url = `${getPortalUrl(requestOptions)}/content/users/${itemOwner}/items/${requestOptions.id}/share`;\n  }\n\n  // now its finally time to do the sharing\n  requestOptions.params = {\n    groups: requestOptions.groupId,\n    confirmItemControl: requestOptions.confirmItemControl\n  };\n\n  return request(url, requestOptions);\n}\n\nexport function ensureMembership (\n  currentUser: IUser,\n  ownerUser: IUser,\n  shouldPromote: boolean,\n  errorMessage: string,\n  requestOptions: IGroupSharingOptions\n): IEnsureMembershipResult {\n  const ownerGroups = ownerUser.groups || [];\n  const group = ownerGroups.find(g => {\n    return g.id === requestOptions.groupId;\n  });\n\n  // if they are in different orgs, eject\n  if (currentUser.orgId !== ownerUser.orgId) {\n    throw Error(\n      `User ${ownerUser.username} is not a member of the same org as ${currentUser.username}. Consequently they can not be added added to group ${requestOptions.groupId} nor can item ${requestOptions.id} be shared to the group.`\n    );\n  }\n\n  // if owner is not a member, and has 512 groups\n  if (!group && ownerGroups.length > 511) {\n    throw Error(\n      `User ${ownerUser.username} already has 512 groups, and can not be added to group ${requestOptions.groupId}. Consequently item ${requestOptions.id} can not be shared to the group.`\n    );\n  }\n\n  let promise: Promise<IAddGroupUsersResult>;\n  let revert: (sharingResults: ISharingResponse) => Promise<ISharingResponse>;\n\n  // decide if we need to add them or upgrade them\n  if (group) {\n    // they are in the group...\n    // check member type\n    if (shouldPromote && group.userMembership.memberType === \"member\") {\n      // promote them\n      promise = updateUserMemberships({\n        id: requestOptions.groupId,\n        users: [ownerUser.username],\n        newMemberType: \"admin\",\n        authentication: requestOptions.authentication\n      })\n        .then((results: IUpdateGroupUsersResult) => {\n          // convert the result into the right type\n          const notAdded = results.results.reduce(\n            (acc: any[], entry: any) => {\n              if (!entry.success) {\n                acc.push(entry.username);\n              }\n              return acc;\n            },\n            []\n          );\n          // and return it\n          return Promise.resolve({ notAdded });\n        })\n        .catch(() => ({ notAdded: [ownerUser.username] }));\n      revert = (sharingResults) => updateUserMemberships({\n        id: requestOptions.groupId,\n        users: [ownerUser.username],\n        newMemberType: \"member\",\n        authentication: requestOptions.authentication\n      })\n        .then(() => sharingResults)\n        .catch(() => sharingResults);\n    } else {\n      // they are already an admin in the group\n      // return the same response the API would if we added them\n      promise = Promise.resolve({ notAdded: [] });\n      revert = sharingResults => Promise.resolve(sharingResults);\n    }\n  } else {\n    // attempt to add user to group\n    const userType = shouldPromote ? \"admins\" : \"users\";\n    // can't currently determine if the group is within the admin's\n    // org without performing a search, so attempt to add and handle\n    // the api error\n    promise = addGroupUsers({\n      id: requestOptions.groupId,\n      [userType]: [ownerUser.username],\n      authentication: requestOptions.authentication\n    })\n      .then(results => {\n        // results.errors includes an ArcGISAuthError when the group\n        // is in a different org, but notAdded is empty, throw here\n        // to normalize the results in below catch\n        if (results.errors && results.errors.length) {\n          throw results.errors[0];\n        }\n        return results;\n      })\n      .catch(() => ({ notAdded: [ownerUser.username] }));\n    revert = (sharingResults) => {\n      return removeGroupUsers({\n        id: requestOptions.groupId,\n        users: [ownerUser.username],\n        authentication: requestOptions.authentication\n      })\n        .then(() => {\n          // always resolves, suppress any resolved errors\n          return sharingResults;\n        });\n    };\n  }\n\n  return {\n    promise: promise.then(membershipResponse => {\n      if (membershipResponse.notAdded.length) {\n        throw new Error(errorMessage);\n      }\n      return membershipResponse;\n    }),\n    revert\n  };\n};\n","/* Copyright (c) 2017-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request, IRequestOptions } from \"@esri/arcgis-rest-request\";\n\nimport { getPortalUrl } from \"./get-portal-url\";\n\nexport interface IPortal {\n  id: string;\n  isPortal: boolean;\n  name: string;\n  [key: string]: any;\n}\n\n/**\n * Get the portal\n * @param requestOptions\n */\nexport function getSelf(requestOptions?: IRequestOptions): Promise<IPortal> {\n  // just delegate to getPortal w/o an id\n  return getPortal(null, requestOptions);\n}\n\n/**\n * ```js\n * import { getPortal } from \"@esri/arcgis-rest-request\";\n * //\n * getPortal()\n * getPortal(\"fe8\")\n * getPortal(null, { portal: \"https://custom.maps.arcgis.com/sharing/rest/\" })\n * ```\n * Fetch information about the specified portal by id. If no id is passed, portals/self will be called.\n * Note that if you intend to request a portal by id and it is different from the portal specified by options.authentication, you must also pass options.portal.\n * @param id\n * @param requestOptions\n */\nexport function getPortal(\n  id?: string,\n  requestOptions?: IRequestOptions\n): Promise<IPortal> {\n  // construct the search url\n  const idOrSelf = id ? id : \"self\";\n  const url = `${getPortalUrl(requestOptions)}/portals/${idOrSelf}`;\n\n  // default to a GET request\n  const options: IRequestOptions = {\n    ...{ httpMethod: \"GET\" },\n    ...requestOptions\n  };\n\n  // send the request\n  return request(url, options);\n}\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { IGroup } from \"@esri/arcgis-rest-types\";\n\nimport { IUserRequestOptions } from \"@esri/arcgis-rest-auth\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\n\nexport interface IInvitation {\n  id: string;\n  targetType: string;\n  targetId: string;\n  received: number;\n  accepted: boolean;\n  mustApprove: boolean;\n  email: string;\n  role: string;\n  type: string;\n  dateAccepted: number;\n  expiration: number;\n  created: number;\n  username: string;\n  fromUsername: {\n    username: string;\n    fullname?: string;\n  };\n  group?: IGroup;\n  groupId?: string;\n}\n\nexport interface IInvitationResult {\n  userInvitations: IInvitation[];\n}\n\n/**\n * ```js\n * import { getUserInvitations } from '@esri/arcgis-rest-portal';\n * // username is inferred from UserSession\n * getUserInvitations({ authentication })\n *   .then(response) // response.userInvitations.length => 3\n * ```\n * Get all invitations for a user. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/user-invitations.htm) for more information.\n *\n * @param requestOptions - options to pass through in the request\n * @returns A Promise that will resolve with the user's invitations\n */\nexport function getUserInvitations(\n  requestOptions: IUserRequestOptions\n): Promise<IInvitationResult> {\n  let options = { httpMethod: \"GET\" } as IUserRequestOptions;\n\n  const username = encodeURIComponent(requestOptions.authentication.username);\n  const portalUrl = getPortalUrl(requestOptions);\n  const url = `${portalUrl}/community/users/${username}/invitations`;\n  options = { ...requestOptions, ...options };\n\n  // send the request\n  return request(url, options);\n}\n\nexport interface IGetUserInvitationOptions extends IUserRequestOptions {\n  invitationId: string;\n}\n\n/**\n * ```js\n * import { getUserInvitation } from '@esri/arcgis-rest-portal';\n * // username is inferred from UserSession\n * getUserInvitation({\n *   invitationId: \"3ef\",\n *   authentication\n * })\n *   .then(response) // => response.accepted => true\n * ```\n * Get an invitation for a user by id. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/user-invitation.htm) for more information.\n *\n * @param requestOptions - options to pass through in the request\n * @returns A Promise that will resolve with the invitation\n */\nexport function getUserInvitation(\n  requestOptions: IGetUserInvitationOptions\n): Promise<IInvitation> {\n  const username = encodeURIComponent(requestOptions.authentication.username);\n  const portalUrl = getPortalUrl(requestOptions);\n  const url = `${portalUrl}/community/users/${username}/invitations/${requestOptions.invitationId}`;\n\n  let options = { httpMethod: \"GET\" } as IGetUserInvitationOptions;\n  options = { ...requestOptions, ...options };\n\n  // send the request\n  return request(url, options);\n}\n\n/**\n * ```js\n * import { acceptInvitation } from '@esri/arcgis-rest-portal';\n * // username is inferred from UserSession\n * acceptInvitation({\n *   invitationId: \"3ef\",\n *   authentication\n * })\n *   .then(response)\n * ```\n * Accept an invitation. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/accept-invitation.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the success/failure status of the request\n */\nexport function acceptInvitation(\n  requestOptions: IGetUserInvitationOptions\n): Promise<{\n  success: boolean;\n  username: string;\n  groupId: string;\n  id: string;\n}> {\n  const username = encodeURIComponent(requestOptions.authentication.username);\n  const portalUrl = getPortalUrl(requestOptions);\n  const url = `${portalUrl}/community/users/${username}/invitations/${requestOptions.invitationId}/accept`;\n\n  const options: IGetUserInvitationOptions = { ...requestOptions };\n  return request(url, options);\n}\n\n/**\n * ```js\n * import { declineInvitation } from '@esri/arcgis-rest-portal';\n * // username is inferred from UserSession\n * declineInvitation({\n *   invitationId: \"3ef\",\n *   authentication\n * })\n *   .then(response)\n * ```\n * Decline an invitation. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/decline-invitation.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the success/failure status of the request\n */\nexport function declineInvitation(\n  requestOptions: IGetUserInvitationOptions\n): Promise<{\n  success: boolean;\n  username: string;\n  groupId: string;\n  id: string;\n}> {\n  const username = encodeURIComponent(requestOptions.authentication.username);\n  const portalUrl = getPortalUrl(requestOptions);\n  const url = `${portalUrl}/community/users/${username}/invitations/${requestOptions.invitationId}/decline`;\n\n  const options: IGetUserInvitationOptions = { ...requestOptions };\n  return request(url, options);\n}\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport {\n  IUserItemOptions,\n  IItemResourceOptions,\n  IUpdateItemResponse,\n  IItemResourceResponse,\n  determineOwner,\n  IManageItemRelationshipOptions\n} from \"./helpers\";\nimport { updateItem, IUpdateItemOptions } from \"./update\";\n\nexport interface IAddItemDataOptions extends IUserItemOptions {\n  /**\n   * Object to store\n   */\n  data: any;\n}\n\n/**\n * ```js\n * import { addItemData } from \"@esri/arcgis-rest-portal\";\n * //\n * addItemData({\n *   id: '3ef',\n *   data: file,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Send a file or blob to an item to be stored as the `/data` resource. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-item.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with an object reporting\n *        success/failure and echoing the item id.\n */\nexport function addItemData(\n  requestOptions: IAddItemDataOptions\n): Promise<IUpdateItemResponse> {\n  const options: any = {\n    item: {\n      id: requestOptions.id,\n      data: requestOptions.data\n    },\n    ...requestOptions\n  };\n\n  delete options.id;\n  delete options.data;\n\n  return updateItem(options as IUpdateItemOptions);\n}\n\n/**\n * ```js\n * import { addItemRelationship } from \"@esri/arcgis-rest-portal\";\n * //\n * addItemRelationship({\n *   originItemId: '3ef',\n *   destinationItemId: 'ae7',\n *   relationshipType: 'Service2Layer',\n *   authentication\n * })\n *   .then(response)\n * ```\n * Add a relationship between two items. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/add-relationship.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to add item resources.\n */\nexport function addItemRelationship(\n  requestOptions: IManageItemRelationshipOptions\n): Promise<{ success: boolean }> {\n  return determineOwner(requestOptions).then(owner => {\n    const url = `${getPortalUrl(\n      requestOptions\n    )}/content/users/${owner}/addRelationship`;\n\n    const options = appendCustomParams<IManageItemRelationshipOptions>(\n      requestOptions,\n      [\"originItemId\", \"destinationItemId\", \"relationshipType\"],\n      { params: { ...requestOptions.params } }\n    );\n    return request(url, options);\n  });\n}\n\n/**\n * ```js\n * import { addItemResource } from \"@esri/arcgis-rest-portal\";\n *\n * // Add a file resource\n * addItemResource({\n *   id: '3ef',\n *   resource: file,\n *   name: 'bigkahuna.jpg',\n *   authentication\n * })\n *   .then(response)\n *\n * // Add a text resource\n * addItemResource({\n *   id: '4fg',\n *   content: \"Text content\",\n *   name: 'bigkahuna.txt',\n *   authentication\n * })\n *   .then(response)\n * ```\n * Add a resource associated with an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/add-resources.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to add item resources.\n */\nexport function addItemResource(\n  requestOptions: IItemResourceOptions\n): Promise<IItemResourceResponse> {\n  return determineOwner(requestOptions).then(owner => {\n    const url = `${getPortalUrl(requestOptions)}/content/users/${owner}/items/${\n      requestOptions.id\n    }/addResources`;\n\n    requestOptions.params = {\n      file: requestOptions.resource,\n      fileName: requestOptions.name,\n      resourcesPrefix: requestOptions.prefix,\n      text: requestOptions.content,\n      access: requestOptions.private ? \"private\" : \"inherit\",\n      ...requestOptions.params\n    };\n\n    return request(url, requestOptions);\n  });\n}\n","/* Copyright (c) 2017-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\nimport { IItemAdd } from \"@esri/arcgis-rest-types\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport {\n  IUserItemOptions,\n  IUpdateItemResponse,\n  determineOwner,\n  IItemPartOptions,\n  serializeItem\n} from \"./helpers\";\n\nexport interface ICommitItemOptions extends IUserItemOptions {\n  item: IItemAdd;\n}\n\n/**\n * ```js\n * import { addItemPart } from \"@esri/arcgis-rest-portal\";\n * //\n * addItemPart({\n *   id: \"30e5fe3149c34df1ba922e6f5bbf808f\",\n *   file: data,\n *   partNum: 1,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Add Item Part allows the caller to upload a file part when doing an add or update item operation in multipart mode. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/add-item-part.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to add the item part status.\n */\nexport function addItemPart(\n  requestOptions?: IItemPartOptions\n): Promise<IUpdateItemResponse> {\n  const partNum = requestOptions.partNum;\n\n  if (!Number.isInteger(partNum) || partNum < 1 || partNum > 10000) {\n    return Promise.reject(new Error('The part number must be an integer between 1 to 10000, inclusive.'))\n  }\n\n  return determineOwner(requestOptions).then(owner => {\n    // AGO adds the \"partNum\" parameter in the query string, not in the body\n    const url = `${getPortalUrl(requestOptions)}/content/users/${owner}/items/${\n      requestOptions.id\n    }/addPart?partNum=${partNum}`;\n\n    const options = appendCustomParams<IItemPartOptions>(\n      requestOptions,\n      [\"file\"],\n      { params: { ...requestOptions.params } }\n    );\n\n    return request(url, options);\n  });\n}\n\n/**\n * ```js\n * import { commitItemUpload } from \"@esri/arcgis-rest-portal\";\n * //\n * commitItemUpload({\n *   id: \"30e5fe3149c34df1ba922e6f5bbf808f\",\n *   authentication\n * })\n *   .then(response)\n * ```\n * Commit is called once all parts are uploaded during a multipart Add Item or Update Item operation. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/commit.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to get the commit result.\n */\nexport function commitItemUpload(\n  requestOptions?: ICommitItemOptions\n): Promise<IUpdateItemResponse> {\n  return determineOwner(requestOptions).then(owner => {\n    const url = `${getPortalUrl(requestOptions)}/content/users/${owner}/items/${\n      requestOptions.id\n    }/commit`;\n\n    const options = appendCustomParams<ICommitItemOptions>(\n      requestOptions,\n      [],\n      {\n        params: {\n          ...requestOptions.params,\n          ...serializeItem(requestOptions.item)\n        }\n      }\n    );\n\n    return request(url, options);\n  });\n}\n\n/**\n * ```js\n * import { cancelItemUpload } from \"@esri/arcgis-rest-portal\";\n * //\n * cancelItemUpload({\n *   id: \"30e5fe3149c34df1ba922e6f5bbf808f\",\n *   authentication\n * })\n *   .then(response)\n * ```\n * Cancels a multipart upload on an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/cancel.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to get the commit result.\n */\nexport function cancelItemUpload(\n  requestOptions?: IUserItemOptions\n): Promise<IUpdateItemResponse> {\n  return determineOwner(requestOptions).then(owner => {\n    const url = `${getPortalUrl(requestOptions)}/content/users/${owner}/items/${\n      requestOptions.id\n    }/cancel`;\n\n    return request(url, requestOptions);\n  });\n}\n","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request, IRequestOptions } from \"@esri/arcgis-rest-request\";\nimport { IGroupAdd, IGroup } from \"@esri/arcgis-rest-types\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\n\nexport interface ICreateGroupOptions extends IRequestOptions {\n  group: IGroupAdd;\n}\n\n/**\n * ```js\n * import { createGroup } from \"@esri/arcgis-rest-portal\";\n * //\n * createGroup({\n *   group: {\n *     title: \"No Homers\",\n *     access: \"public\"\n *   },\n *   authentication\n * })\n *   .then(response)\n * ```\n * Create a new Group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/create-group.htm) for more information.\n *\n * Note: The group name must be unique within the user's organization.\n * @param requestOptions  - Options for the request, including a group object\n * @returns A Promise that will resolve with the success/failure status of the request\n */\nexport function createGroup(\n  requestOptions: ICreateGroupOptions\n): Promise<{ success: boolean; group: IGroup }> {\n  const url = `${getPortalUrl(requestOptions)}/community/createGroup`;\n\n  requestOptions.params = {\n    ...requestOptions.params,\n    ...requestOptions.group\n  };\n\n  return request(url, requestOptions);\n}\n","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { IUserGroupOptions } from \"./helpers\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\n\nexport type NotificationChannelType = \"push\" | \"email\" | \"builtin\";\n\nexport interface ICreateGroupNotificationOptions extends IUserGroupOptions {\n  /**\n   * Subject of the notification. This only applies to email and builtin notifications. For push notifications, subject/title is provided as a part of the message payload.\n   */\n  subject?: string;\n  /**\n   * Message to be sent. For builtin and email notifications this is a string. For push notifications, this will be JSON.\n   */\n  message: string | object;\n  /**\n   * Array of usernames of the users in the group to whom the message should be sent. If not provided, the message will be sent to all users in the group if the user is an admin. Only group admins will be able to send notifications to a list of users. Group users will be able to send notifications to only one user at a time.\n   */\n  users?: string[];\n  /**\n   * The channel through which the notification is to be delivered. Supported values are push, email, or builtin. If push is chosen, a message will be delivered only to those group members that have registered their devices to receive push notifications. If the user has registered more than one device for the app, then message will be sent to all the registered devices. Email will be sent when the email option is chosen. If the builtin option is chosen, a notification will be added to the notifications list that the user can see when logged into the home app.\n   */\n  notificationChannelType?: NotificationChannelType;\n  /**\n   * ClientId of the application through which user receives messages on the mobile device. This only applies to push notifications.\n   */\n  clientId?: string;\n  /**\n   * This only applies to push notifications. When set to true, message will be delivered to the app and it will not show as an alert to the user.\n   */\n  silentNotification?: boolean;\n}\n\n/**\n * ```js\n * import { createGroupNotification } from '@esri/arcgis-rest-portal';\n * // send an email to an entire group\n * createGroupNotification({\n *   authentication: UserSession,\n *   subject: \"hello\",\n *   message: \"world!\",\n *   id: groupId\n * })\n * ```\n * Create a group notification.\n *\n * @param requestOptions - Options for the request\n *\n * @returns A Promise that will resolve with the success/failure status of the request\n */\nexport function createGroupNotification(\n  requestOptions: ICreateGroupNotificationOptions\n): Promise<any> {\n  const url = `${getPortalUrl(requestOptions)}/community/groups/${\n    requestOptions.id\n  }/createNotification`;\n\n  const options: ICreateGroupNotificationOptions = {\n    params: {\n      subject: requestOptions.subject,\n      message: requestOptions.message,\n      users: requestOptions.users,\n      notificationChannelType:\n        requestOptions.notificationChannelType || \"email\",\n      clientId: requestOptions.clientId,\n      silentNotification: requestOptions.silentNotification,\n      notifyAll: !requestOptions.users || requestOptions.users.length === 0,\n      ...requestOptions.params\n    },\n    ...requestOptions\n  };\n  return request(url, options);\n}\n","import { request } from \"@esri/arcgis-rest-request\";\nimport { determineOwner, IUserItemOptions } from './helpers';\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { ISpatialReference } from '@esri/arcgis-rest-types';\n\ntype ExportFormat = 'Shapefile' | 'CSV' | 'File Geodatabase' | 'Feature Collection' | 'GeoJson' | 'Scene Package' | 'KML' | 'Excel';\n\nexport interface IExportLayerInfo {\n  id: number;\n  where?: string;\n  includeGeometry?: boolean;\n  xColumnName?: string;\n  yColumnName?: string;\n}\n\nexport interface IExportParameters {\n  layers?: IExportLayerInfo[];\n  targetSR?: ISpatialReference | string;\n}\n\nexport interface IExportItemRequestOptions extends IUserItemOptions {\n  title?: string;\n  exportFormat: ExportFormat;\n  exportParameters?: IExportParameters;\n}\n\nexport interface IExportItemResponse {\n  type: string;\n  size: number;\n  jobId: string;\n  exportItemId: string;\n  serviceItemId: string;\n  exportFormat: ExportFormat;\n}\n\n/**\n * ```js\n * import { exportItem } from \"@esri/arcgis-rest-portal\";\n * //\n * exportItem({\n *      id: '3daf',\n *      owner: 'geemike',\n *      exportFormat: 'CSV',\n *      exportParameters: {\n *        layers: [\n *          { id: 0 },\n *          { id: 1, where: 'POP1999 > 100000' }\n *        ]\n *      },\n *      authentication,\n *    })\n * ```\n * Exports an item from the portal. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/export-item.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise<IExportItemResponse>\n */\nexport const exportItem = (requestOptions: IExportItemRequestOptions) : Promise<IExportItemResponse> => {\n  const {\n    authentication,\n    id: itemId,\n    title,\n    exportFormat,\n    exportParameters\n  } = requestOptions;\n\n  return determineOwner(requestOptions)\n    .then(owner => `${getPortalUrl(requestOptions)}/content/users/${owner}/export`)\n    .then(url => request(url, {\n        httpMethod: 'POST',\n        authentication,\n        params: {\n          itemId,\n          title,\n          exportFormat,\n          exportParameters\n        }\n      })\n    );\n}\n","/* Copyright (c) 2017-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { IExtent } from \"@esri/arcgis-rest-types\";\nimport { request, IRequestOptions } from \"@esri/arcgis-rest-request\";\n\nimport { getPortalUrl } from \"./get-portal-url\";\n\nexport interface IPortalSettings {\n  allowedRedirectUris: string[];\n  defaultExtent: IExtent;\n  helperServices: { [key: string]: any };\n  informationalBanner: { [key: string]: any };\n  [key: string]: any;\n}\n\n/**\n * ```js\n * import { getPortalSettings } from \"@esri/arcgis-rest-portal\";\n * //\n * getPortalSettings()\n * getPortalSettings(\"fe8\")\n * getPortalSettings(null, { portal: \"https://custom.maps.arcgis.com/sharing/rest/\" })\n * ```\n * Fetch the settings for the current portal by id. If no id is passed, portals/self/settings will be called\n * @param id\n * @param requestOptions\n */\nexport function getPortalSettings(\n  id?: string,\n  requestOptions?: IRequestOptions\n): Promise<IPortalSettings> {\n  // construct the search url\n  const idOrSelf = id ? id : \"self\";\n  const url = `${getPortalUrl(requestOptions)}/portals/${idOrSelf}/settings`;\n\n  // default to a GET request\n  const options: IRequestOptions = {\n    ...{ httpMethod: \"GET\" },\n    ...requestOptions\n  };\n\n  // send the request\n  return request(url, options);\n}\n","import { request, IRequestOptions } from \"@esri/arcgis-rest-request\";\nimport {\n  IPagingParams,\n  IItem,\n  IFolder,\n  IPagedResponse,\n} from \"@esri/arcgis-rest-types\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { determineOwner } from \"./helpers\";\n\nexport type UnixTime = number;\n\nexport interface IUserContentRequestOptions\n  extends IPagingParams,\n    IRequestOptions {\n  owner?: string;\n  folderId?: string;\n}\n\nexport interface IUserContentResponse extends IPagedResponse {\n  username: string;\n  currentFolder?: IFolder;\n  items: IItem[];\n  folders: IFolder[];\n}\n\n/**\n * ```js\n * import { getUserContent } from \"@esri/arcgis-rest-portal\";\n * //\n * getUserContent({\n *    owner: 'geemike',\n *    folderId: 'bao7',\n *    start: 1,\n *    num: 20,\n *    authentication\n * })\n * ```\n * Returns a listing of the user's content. If the `username` is not supplied, it defaults to the username of the authenticated user. If `start` is not specificed it defaults to the first page.\n * If the `num` is not supplied it is defaulted to 10. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/user-content.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise<IUserContentResponse>\n */\nexport const getUserContent = (\n  requestOptions: IUserContentRequestOptions\n): Promise<IUserContentResponse> => {\n  const {\n    folderId: folder,\n    start = 1,\n    num = 10,\n    authentication,\n  } = requestOptions;\n  const suffix = folder ? `/${folder}` : \"\";\n\n  return determineOwner(requestOptions)\n    .then((owner) => `${getPortalUrl(requestOptions)}/content/users/${owner}${suffix}`)\n    .then((url) => request(url, {\n      httpMethod: \"GET\",\n      authentication,\n      params: {\n        start,\n        num,\n      },\n    })\n  );\n};\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { IUserRequestOptions } from \"@esri/arcgis-rest-auth\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\n\nexport interface INotification {\n  id: string;\n  type: string;\n  target: string;\n  targetType: string;\n  received: number;\n  data: { [key: string]: any };\n}\n\nexport interface IRemoveNotificationOptions extends IUserRequestOptions {\n  /**\n   * Unique identifier of the item.\n   */\n  id: string;\n}\nexport interface INotificationResult {\n  notifications: INotification[];\n}\n\n/**\n * ```js\n * import { getUserNotifications } from '@esri/arcgis-rest-portal';\n * // username is inferred from UserSession\n * getUserNotifications({ authentication })\n *   .then(results) // results.notifications.length) => 3\n * ```\n * Get notifications for a user.\n *\n * @param requestOptions - options to pass through in the request\n * @returns A Promise that will resolve with the user's notifications\n */\nexport function getUserNotifications(\n  requestOptions: IUserRequestOptions\n): Promise<INotificationResult> {\n  let options = { httpMethod: \"GET\" } as IUserRequestOptions;\n\n  const username = encodeURIComponent(requestOptions.authentication.username);\n  const portalUrl = getPortalUrl(requestOptions);\n  const url = `${portalUrl}/community/users/${username}/notifications`;\n  options = { ...requestOptions, ...options };\n\n  // send the request\n  return request(url, options);\n}\n\n/**\n * Delete a notification.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the success/failure status of the request\n */\nexport function removeNotification(\n  requestOptions: IRemoveNotificationOptions\n): Promise<{ success: boolean; notificationId: string }> {\n  const username = encodeURIComponent(requestOptions.authentication.username);\n  const portalUrl = getPortalUrl(requestOptions);\n  const url = `${portalUrl}/community/users/${username}/notifications/${requestOptions.id}/delete`;\n\n  return request(url, requestOptions);\n}\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { IGetUserOptions } from \"./get-user\";\n\nexport interface ITagCount {\n  /**\n   * the name of a tag\n   */\n  tag: string;\n  /**\n   * a count that reports the number of times the tag was used\n   */\n  count: number;\n}\n\nexport interface IGetUserTagsResponse {\n  /**\n   * Array of user item tag objects\n   */\n  tags: ITagCount[];\n}\n\n/**\n * ```js\n * import { getUserTags } from '@esri/arcgis-rest-portal';\n * //\n * getUserTags({\n *   username: \"jsmith\",\n *   authentication\n * })\n *   .then(response)\n * ```\n *  Users tag the content they publish in their portal via the add and update item calls. This resource lists all the tags used by the user along with the number of times the tags have been used. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/user-tags.htm) for more information.\n *\n * @param IGetUserOptions - options to pass through in the request\n * @returns A Promise that will resolve with the user tag array\n */\nexport function getUserTags(\n  requestOptions: IGetUserOptions\n): Promise<IGetUserTagsResponse> {\n  const username =\n    requestOptions.username || requestOptions.authentication.username;\n  const url = `${getPortalUrl(\n    requestOptions\n  )}/community/users/${encodeURIComponent(username)}/tags`;\n\n  // send the request\n  return request(url, requestOptions);\n}\n","/* Copyright (c) 2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { UserSession } from \"@esri/arcgis-rest-auth\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\n\n/**\n * Helper that returns the [user](https://developers.arcgis.com/rest/users-groups-and-items/user.htm) for a given portal.\n *\n * @param session\n * @returns User url to be used in API requests.\n */\nexport function getUserUrl(session: UserSession): string {\n  return `${getPortalUrl(session)}/community/users/${encodeURIComponent(\n    session.username\n  )}`;\n}\n","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request } from \"@esri/arcgis-rest-request\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { IUserGroupOptions } from \"./helpers\";\n\n/**\n * ```js\n * import { joinGroup } from '@esri/arcgis-rest-portal';\n * //\n * joinGroup({\n *   id: groupId,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Make a request as the authenticated user to join a Group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/join-group.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the success/failure status of the request and the groupId.\n */\nexport function joinGroup(\n  requestOptions: IUserGroupOptions\n): Promise<{ success: boolean; groupId: string }> {\n  const url = `${getPortalUrl(requestOptions)}/community/groups/${\n    requestOptions.id\n  }/join`;\n\n  return request(url, requestOptions);\n}\n\n/**\n * ```js\n * import { leaveGroup } from '@esri/arcgis-rest-portal';\n * //\n * leaveGroup({\n *   id: groupId,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Make a request as the authenticated user to leave a Group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/leave-group.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the success/failure status of the request and the groupId.\n */\nexport function leaveGroup(\n  requestOptions: IUserGroupOptions\n): Promise<{ success: boolean; groupId: string }> {\n  const url = `${getPortalUrl(requestOptions)}/community/groups/${\n    requestOptions.id\n  }/leave`;\n\n  return request(url, requestOptions);\n}\n","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request } from \"@esri/arcgis-rest-request\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { IUserGroupOptions } from \"./helpers\";\n\n/**\n * ```js\n * import { protectGroup } from '@esri/arcgis-rest-portal';\n * //\n * protectGroup({\n *   id: groupId,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Protect a group to avoid accidental deletion. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/protect-group.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the success/failure status of the request\n */\nexport function protectGroup(\n  requestOptions: IUserGroupOptions\n): Promise<{ success: boolean }> {\n  const url = `${getPortalUrl(requestOptions)}/community/groups/${\n    requestOptions.id\n  }/protect`;\n\n  return request(url, requestOptions);\n}\n\n/**\n * ```js\n * import { unprotectGroup } from '@esri/arcgis-rest-portal';\n * //\n * unprotectGroup({\n *   id: groupId,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Unprotect a Group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/unprotect-group.htm) for more information.\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the success/failure status of the request\n */\nexport function unprotectGroup(\n  requestOptions: IUserGroupOptions\n): Promise<{ success: boolean }> {\n  const url = `${getPortalUrl(requestOptions)}/community/groups/${\n    requestOptions.id\n  }/unprotect`;\n\n  return request(url, requestOptions);\n}\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request } from \"@esri/arcgis-rest-request\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { IUserItemOptions, determineOwner } from \"./helpers\";\n\n/**\n * Protect an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/protect.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to protect an item.\n */\nexport function protectItem(\n  requestOptions: IUserItemOptions\n): Promise<{ success: boolean }> {\n  return determineOwner(requestOptions).then(owner => {\n    const url = `${getPortalUrl(requestOptions)}/content/users/${owner}/items/${\n      requestOptions.id\n    }/protect`;\n    return request(url, requestOptions);\n  });\n}\n\n/**\n * Unprotect an item. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/unprotect.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to unprotect an item.\n */\nexport function unprotectItem(\n  requestOptions: IUserItemOptions\n): Promise<{ success: boolean }> {\n  return determineOwner(requestOptions).then(owner => {\n    const url = `${getPortalUrl(requestOptions)}/content/users/${owner}/items/${\n      requestOptions.id\n    }/unprotect`;\n    return request(url, requestOptions);\n  });\n}\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { request, IRequestOptions } from \"@esri/arcgis-rest-request\";\nimport { IItem } from \"@esri/arcgis-rest-types\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { isOrgAdmin } from \"../sharing/helpers\";\nimport { IUserRequestOptions } from \"@esri/arcgis-rest-auth\";\n\ninterface IReassignItemOptions extends IUserRequestOptions {\n  id: string;\n  currentOwner: string;\n  targetUsername: string;\n  targetFolderName?: string;\n}\n\ninterface IReassignItemResponse {\n  success: boolean;\n  itemId: string;\n}\n\n/**\n * ```js\n * import { reassignItem } from '@esri/arcgis-rest-portal';\n * //\n * reassignItem({\n *   id: \"abc123\",\n *   currentOwner: \"charles\",\n *   targetUsername: \"leslie\",\n *   authentication\n * })\n * ```\n * Reassign an item from one user to another.\n * Caller must be an org admin or the request will fail.\n * `currentOwner` and `targetUsername` must be in the same\n * organization or the request will fail\n * @param reassignOptions - Options for the request\n */\nexport function reassignItem(\n  reassignOptions: IReassignItemOptions\n): Promise<IReassignItemResponse> {\n  return isOrgAdmin(reassignOptions).then(isAdmin => {\n    if (!isAdmin) {\n      throw Error(\n        `Item ${reassignOptions.id} can not be reassigned because current user is not an organization administrator.`\n      );\n    }\n    // we're operating as an org-admin\n    const url = `${getPortalUrl(reassignOptions)}/content/users/${\n      reassignOptions.currentOwner\n    }/items/${reassignOptions.id}/reassign`;\n\n    const opts = {\n      params: {\n        targetUsername: reassignOptions.targetUsername,\n        targetFolderName: reassignOptions.targetFolderName\n      },\n      authentication: reassignOptions.authentication\n    };\n    return request(url, opts);\n  });\n}\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request, appendCustomParams } from \"@esri/arcgis-rest-request\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport {\n  IUserItemOptions,\n  IItemResourceOptions,\n  IFolderIdOptions,\n  determineOwner,\n  IManageItemRelationshipOptions\n} from \"./helpers\";\n\n/**\n * ```js\n * import { removeItem } from \"@esri/arcgis-rest-portal\";\n * //\n * removeItem({\n *   id: \"3ef\",\n *   authentication\n * })\n * ```\n * Delete an item from the portal. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/delete-item.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that deletes an item.\n */\nexport function removeItem(\n  requestOptions: IUserItemOptions\n): Promise<{ success: boolean; itemId: string }> {\n  return determineOwner(requestOptions).then(owner => {\n    const url = `${getPortalUrl(requestOptions)}/content/users/${owner}/items/${\n      requestOptions.id\n    }/delete`;\n    return request(url, requestOptions);\n  });\n}\n\n/**\n * ```js\n * import { removeItemRelationship } from \"@esri/arcgis-rest-portal\";\n * //\n * removeItemRelationship({\n *   originItemId: '3ef',\n *   destinationItemId: 'ae7',\n *   relationshipType: 'Service2Layer',\n *   authentication\n * })\n *   .then(response)\n * ```\n * Remove a relationship between two items. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/delete-relationship.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise to add item resources.\n */\nexport function removeItemRelationship(\n  requestOptions: IManageItemRelationshipOptions\n): Promise<{ success: boolean }> {\n  return determineOwner(requestOptions).then(owner => {\n    const url = `${getPortalUrl(\n      requestOptions\n    )}/content/users/${owner}/deleteRelationship`;\n\n    const options = appendCustomParams<IManageItemRelationshipOptions>(\n      requestOptions,\n      [\"originItemId\", \"destinationItemId\", \"relationshipType\"],\n      { params: { ...requestOptions.params } }\n    );\n\n    return request(url, options);\n  });\n}\n\n/**\n * Remove a resource associated with an item\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that deletes an item resource.\n */\nexport function removeItemResource(\n  requestOptions: IItemResourceOptions\n): Promise<{ success: boolean }> {\n  return determineOwner(requestOptions).then(owner => {\n    const url = `${getPortalUrl(requestOptions)}/content/users/${owner}/items/${\n      requestOptions.id\n    }/removeResources`;\n\n    // mix in user supplied params\n    requestOptions.params = {\n      ...requestOptions.params,\n      resource: requestOptions.resource\n    };\n    return request(url, requestOptions);\n  });\n}\n\n/**\n * ```js\n * import { removeFolder } from \"@esri/arcgis-rest-portal\";\n * //\n * removeFolder({\n *   folderId: \"fe4\",\n *   owner: \"c@sey\",\n *   authentication\n * })\n *   .then(response)\n *\n * ```\n * Delete a non-root folder and all the items it contains. See the [REST\n * Documentation](https://developers.arcgis.com/rest/users-groups-and-items/delete-folder.htm) for\n * more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that deletes a folder\n */\nexport function removeFolder(\n  requestOptions: IFolderIdOptions\n): Promise<{\n  success: boolean;\n  folder: {\n    username: string;\n    id: string;\n    title: string;\n  };\n}> {\n  return determineOwner(requestOptions).then(owner => {\n    const url = `${getPortalUrl(\n      requestOptions\n    )}/content/users/${encodeURIComponent(owner)}/${\n      requestOptions.folderId\n    }/delete`;\n    return request(url, requestOptions);\n  });\n}\n","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request } from \"@esri/arcgis-rest-request\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport { IUserGroupOptions } from \"./helpers\";\n\n/**\n * ```js\n * import { removeGroup } from '@esri/arcgis-rest-portal';\n * //\n * removeGroup({\n *   id: groupId,\n *   authentication\n * })\n *   .then(response)\n * ```\n * Delete a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/delete-group.htm) for more information.\n *\n * @param requestOptions - Options for the request\n * @returns A Promise that will resolve with the success/failure status of the request\n */\nexport function removeGroup(requestOptions: IUserGroupOptions): Promise<any> {\n  const url = `${getPortalUrl(requestOptions)}/community/groups/${\n    requestOptions.id\n  }/delete`;\n  const options: IUserGroupOptions = {\n    ...requestOptions\n  };\n  return request(url, options);\n}\n","/* Copyright (c) 2018-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { IItem, IGroup } from \"@esri/arcgis-rest-types\";\nimport { SearchQueryBuilder } from \"../util/SearchQueryBuilder\";\nimport {\n  ISearchOptions,\n  ISearchGroupContentOptions,\n  ISearchResult\n} from \"../util/search\";\nimport { genericSearch } from \"../util/generic-search\";\n\n/**\n * ```js\n * import { searchGroups } from \"@esri/arcgis-rest-portal\";\n * //\n * searchGroups('water')\n *   .then(response) // response.total => 355\n * ```\n * Search a portal for groups. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/group-search.htm) for more information.\n *\n * @param search - A string or RequestOptions object to pass through to the endpoint.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function searchGroups(\n  search: string | ISearchOptions | SearchQueryBuilder\n): Promise<ISearchResult<IGroup>> {\n  return genericSearch<IGroup>(search, \"group\");\n}\n\n/**\n * ```js\n * import { searchGroupContent } from \"@esri/arcgis-rest-portal\";\n * //\n * searchGroupContent('water')\n *   .then(response) // response.total => 355\n * ```\n * Search a portal for items in a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/group-content-search.htm) for more information.\n *\n * @param options - RequestOptions object amended with search parameters.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function searchGroupContent(\n  options: ISearchGroupContentOptions\n): Promise<ISearchResult<IItem>> {\n  return genericSearch<IItem>(options, \"groupContent\");\n}\n","/* Copyright (c) 2018-2019 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\nimport { IAuthenticatedRequestOptions } from \"@esri/arcgis-rest-auth\";\nimport { IAuthenticationManager } from \"@esri/arcgis-rest-request\";\nimport { IPagingParams, IUser } from \"@esri/arcgis-rest-types\";\nimport { SearchQueryBuilder } from \"../util/SearchQueryBuilder\";\nimport { ISearchOptions, ISearchResult } from \"../util/search\";\nimport { genericSearch } from \"../util/generic-search\";\n\n// export interface IUserSearchOptions extends IAuthenticatedRequestOptions, IPagingParams {\n//   q: string | SearchQueryBuilder;\n//   sortField?: string;\n//   sortOrder?: string;\n//   [key: string]: any;\n// }\n\nexport interface IUserSearchOptions extends ISearchOptions {\n  authentication: IAuthenticationManager;\n}\n\n/**\n * ```js\n * import { searchItems } from \"@esri/arcgis-rest-portal\";\n * //\n * searchUsers({ q: 'tommy', authentication })\n *   .then(response) // response.total => 355\n * ```\n * Search a portal for users.\n *\n * @param search - A RequestOptions object to pass through to the endpoint.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function searchUsers(\n  search: IUserSearchOptions | SearchQueryBuilder\n): Promise<ISearchResult<IUser>> {\n  return genericSearch<IUser>(search, \"user\");\n}\n","import { request } from \"@esri/arcgis-rest-request\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\nimport {\n  IGroupSharingOptions,\n  ISharingResponse,\n  getUserMembership\n} from \"./helpers\";\nimport { isItemSharedWithGroup } from \"./is-item-shared-with-group\";\nimport { getUser } from \"../users/get-user\";\n\n/**\n * Stop sharing an item with a group, either as an\n * [item owner](https://developers.arcgis.com/rest/users-groups-and-items/unshare-item-as-item-owner-.htm),\n * [group admin](https://developers.arcgis.com/rest/users-groups-and-items/unshare-item-as-group-admin-.htm) or\n * organization admin.\n *\n * ```js\n * import { unshareItemWithGroup } from '@esri/arcgis-rest-portal';\n *\n * unshareItemWithGroup({\n *   id: \"abc123\",\n *   groupId: \"xyz987\",\n *   owner: \"some-owner\",\n *   authentication: session\n * })\n * ```\n *\n * @param requestOptions - Options for the request.\n * @returns A Promise that will resolve with the data from the response.\n */\nexport function unshareItemWithGroup (\n  requestOptions: IGroupSharingOptions\n): Promise<ISharingResponse> {\n  return isItemSharedWithGroup(requestOptions)\n    .then(isShared => {\n      // not shared\n      if (!isShared) {\n        // exit early with success response\n        return Promise.resolve({\n          itemId: requestOptions.id,\n          shortcut: true,\n          notUnsharedFrom: []\n        } as ISharingResponse);\n      }\n\n      const {\n        authentication: { username },\n        owner\n      } = requestOptions;\n\n      // next check if the user is a member of the group\n      return Promise.all([\n        getUserMembership(requestOptions),\n        getUser({\n          username,\n          authentication: requestOptions.authentication\n        })\n      ])\n        .then(([membership, currentUser]) => {\n          const itemOwner = owner || username;\n          const isItemOwner = itemOwner === username;\n          const isAdmin = currentUser.role === 'org_admin' && !currentUser.roleId;\n\n          if (!isItemOwner && !isAdmin && ['admin', 'owner'].indexOf(membership) < 0) {\n            // abort and reject promise\n            throw Error(`This item can not be unshared from group ${requestOptions.groupId} by ${username} as they not the item owner, an org admin, group admin or group owner.`);\n          }\n          \n          // let the sharing call go\n          return unshareFromGroup(requestOptions);\n        })\n        .then(sharingResponse => {\n          if (sharingResponse.notUnsharedFrom.length) {\n            throw Error(\n              `Item ${requestOptions.id} could not be unshared to group ${requestOptions.groupId}`\n            );\n          } else {\n            // all is well\n            return sharingResponse;\n          }\n        });\n  });\n}\n\nfunction unshareFromGroup (\n  requestOptions: IGroupSharingOptions\n): Promise<ISharingResponse> {\n  const username = requestOptions.authentication.username;\n  const itemOwner = requestOptions.owner || username;\n  // decide what url to use\n  // default to the non-owner url...\n  let url = `${getPortalUrl(requestOptions)}/content/items/${requestOptions.id}/unshare`;\n\n  // but if they are the owner, we use a different path...\n  if (itemOwner === username) {\n    url = `${getPortalUrl(requestOptions)}/content/users/${itemOwner}/items/${requestOptions.id}/unshare`;\n  }\n\n  // now its finally time to do the sharing\n  requestOptions.params = {\n    groups: requestOptions.groupId\n  };\n\n  return request(url, requestOptions);\n}","/* Copyright (c) 2017-2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request, IRequestOptions } from \"@esri/arcgis-rest-request\";\nimport { IItemUpdate } from \"@esri/arcgis-rest-types\";\nimport { getPortalUrl } from \"../util/get-portal-url\";\n\nexport interface IUpdateGroupOptions extends IRequestOptions {\n  group: IItemUpdate;\n}\n\n/**\n * ```js\n * import { updateGroup } from '@esri/arcgis-rest-portal';\n * //\n * updateGroup({\n *   group: { id: \"fgr344\", title: \"new\" }\n * })\n *   .then(response)\n * ```\n * Update the properties of a group. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-group.htm) for more information.\n *\n * @param requestOptions - Options for the request, including the group\n * @returns A Promise that will resolve with the success/failure status of the request\n */\nexport function updateGroup(\n  requestOptions: IUpdateGroupOptions\n): Promise<{ success: boolean; groupId: string }> {\n  const url = `${getPortalUrl(requestOptions)}/community/groups/${\n    requestOptions.group.id\n  }/update`;\n\n  requestOptions.params = {\n    ...requestOptions.params,\n    ...requestOptions.group\n  };\n\n  return request(url, requestOptions);\n}\n","/* Copyright (c) 2018 Environmental Systems Research Institute, Inc.\n * Apache-2.0 */\n\nimport { request } from \"@esri/arcgis-rest-request\";\nimport { IUser } from \"@esri/arcgis-rest-types\";\n\nimport { IUserRequestOptions } from \"@esri/arcgis-rest-auth\";\n\nimport { getPortalUrl } from \"../util/get-portal-url\";\n\nexport interface IUpdateUserOptions extends IUserRequestOptions {\n  /**\n   * The user properties to be updated.\n   */\n  user: IUser;\n}\n\nexport interface IUpdateUserResponse {\n  success: boolean;\n  username: string;\n}\n\n/**\n * ```js\n * import { updateUser } from '@esri/arcgis-rest-portal';\n * // any user can update their own profile\n * updateUser({\n *   authentication,\n *   user: { description: \"better than the last one\" }\n * })\n *   .then(response)\n * // org administrators must declare the username that will be updated explicitly\n * updateUser({\n *   authentication,\n *   user: { username: \"c@sey\", description: \"\" }\n * })\n *   .then(response)\n * // => { \"success\": true, \"username\": \"c@sey\" }\n * ```\n * Update a user profile. The username will be extracted from the authentication session unless it is provided explicitly. See the [REST Documentation](https://developers.arcgis.com/rest/users-groups-and-items/update-user.htm) for more information.\n *\n * @param requestOptions - options to pass through in the request\n * @returns A Promise that will resolve with metadata about the user\n */\nexport function updateUser(\n  requestOptions?: IUpdateUserOptions\n): Promise<IUpdateUserResponse> {\n  // default to the authenticated username unless another username is provided manually\n  const username =\n    requestOptions.user.username || requestOptions.authentication.username;\n\n  const updateUrl = `${getPortalUrl(\n    requestOptions\n  )}/community/users/${encodeURIComponent(username)}/update`;\n\n  // mixin custom params and the user information, then drop the user info\n  requestOptions.params = {\n    ...requestOptions.user,\n    ...requestOptions.params\n  };\n\n  delete requestOptions.user;\n\n  // send the request\n  return request(updateUrl, requestOptions);\n}\n"],"names":["getPortalUrl","requestOptions","portal","cleanUrl","authentication","serializeItem","item","clone","JSON","parse","stringify","data","Blob","constructor","name","file","text","determineOwner","owner","Promise","resolve","getUsername","reject","Error","updateItem","then","url","folderId","id","params","request","createItemInFolder","multipart","filename","baseUrl","options","appendCustomParams","CONTROL_CHAR_MATCHER","scrubControlChars","str","replace","getItemBaseUrl","portalUrlOrRequestOptions","getItemInfo","_a","_b","_c","getItemFile","httpMethod","fileName","readMethod","justReturnResponse","rawResponse","f","response","getGroup","getSharingUrl","username","encodeURIComponent","isItemOwner","isOrgAdmin","getUser","user","role","roleId","getUserMembership","groupId","group","userMembership","memberType","catch","SearchQueryBuilder","_i","terms","this","termStack","concat","field","fn","hasRange","hasTerms","q","commit","warn","openGroups","addModifier","term","rangeStack","num","cleanup","modifier","currentModifer","toUpperCase","s","test","Date","getTime","hasWhiteSpace","undefined","formatTerm","map","_this","join","Object","length","oldQ","genericSearch","search","searchType","path","r","nextStart","nextPage","newOptions","start","searchItems","chunk","array","size","chunks","i","push","slice","addGroupUsers","baseOptions","assign","admins","users","promises","_prepareRequests","error","errors","all","_consolidateRequestResults","type","usernames","results","notAdded","filter","result","reduce","collection","consolidated","removeGroupUsers","usersToRemove","usersChunk","filtered","propName","notRemoved","_combineResults","responses","success","every","res","combined","updateUserMemberships","opts","newMemberType","updateItemAccess","org","everyone","access","groups","account","isItemSharedWithGroup","sortField","searchResponse","total","some","itm","shareToGroup","itemOwner","confirmItemControl","ensureMembership","currentUser","ownerUser","shouldPromote","errorMessage","userType","promise","revert","ownerGroups","find","g","orgId","acc","entry","sharingResults","membershipResponse","getPortal","idOrSelf","invitationId","partNum","Number","isInteger","resource","resourcesPrefix","prefix","content","private","title","subject","message","notificationChannelType","clientId","silentNotification","notifyAll","__assign","batchSize","batch","itemId","exportFormat","exportParameters","paging","err","RegExp","readAs","direction","relationshipType","relationshipTypes","folder","suffix","session","expiration","reassignOptions","isAdmin","currentOwner","targetUsername","targetFolderName","searchOptions","admin","isShared","shortcut","notSharedWith","membership","isSharedEditingGroup","membershipGuarantees","favGroupId","getMembershipAdjustments","membershipAdjustments","sharingResponse","notUnsharedFrom","indexOf","unshareFromGroup","folderName","updateUrl"],"mappings":";;;;;2iBAYgBA,EAAaC,GAE3B,oBAF2BA,MAEvBA,EAAeC,OACVC,WAASF,EAAeC,QAI7BD,EAAeG,eAEVH,EAAeG,eAAeF,OAIhC,+CCyNOG,EAAcC,GAE5B,IAAMC,EAAQC,KAAKC,MAAMD,KAAKE,UAAUJ,IAYxC,OARIC,EAAMI,OACS,oBAATC,MAAwBN,EAAKK,gBAAgBC,MAEtB,eAA/BN,EAAKK,KAAKE,YAAYC,KACjBP,EAAMQ,KAAOT,EAAKK,KAClBJ,EAAMS,KAAOV,EAAKK,YAChBJ,EAAMI,MAERJ,WAMOU,EAAehB,GAC7B,OAAIA,EAAeiB,MACVC,QAAQC,QAAQnB,EAAeiB,OAC7BjB,EAAeK,MAAQL,EAAeK,KAAKY,MAC7CC,QAAQC,QAAQnB,EAAeK,KAAKY,OAE3CjB,EAAeG,gBACfH,EAAeG,eAAeiB,YAEvBpB,EAAeG,eAAeiB,cAE9BF,QAAQG,OACb,IAAIC,MACF,qHC9NQC,EACdvB,GAEA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMQ,EAAMzB,EAAe0B,SACpB3B,EAAaC,qBAAiCiB,MAASjB,EAAe0B,mBAAkB1B,EAAeK,KAAKsB,aAC5G5B,EAAaC,qBAAiCiB,YAAejB,EAAeK,KAAKsB,aAQxF,OALA3B,EAAe4B,cACV5B,EAAe4B,QACfxB,EAAcJ,EAAeK,OAG3BwB,UAAQJ,EAAKzB,cCWR8B,EACd9B,GAEA,OAAIA,EAAe+B,YAAc/B,EAAegC,SACvCd,QAAQG,OACb,IAAIC,MAAM,sDAIPN,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMgB,EAAalC,EAAaC,qBAAiCiB,EAC7DQ,EAASQ,aAETjC,EAAe0B,WACjBD,EAASQ,MAAWjC,EAAe0B,qBAGrC1B,EAAe4B,cACV5B,EAAe4B,QACfxB,EAAcJ,EAAeK,OAIlC,IAAM6B,EAAUC,qBACdnC,EACA,CACE,QACA,WACA,OACA,UACA,OACA,QACA,YACA,WACA,aAEF,CACE4B,YAAa5B,EAAe4B,UAIhC,OAAOC,UAAQJ,EAAKS,SCvHlBE,EAAuB,qCASbC,EAAmBC,GACjC,OAAOA,EAAIC,QAAQH,EAAsB,QC8C9BI,EAAiB,SAC5Bb,EACAc,GAMA,OAHuC,iBAA9BA,EACHA,EACA1C,EAAa0C,sBACkBd,YAiTvBe,EACdf,EACA3B,GAEM,IAAA2C,EAAiD3C,GAAkB,GAAjE4C,aAA2BC,WAKnC,OAAOC,EAAYnB,EAAI,qBALJ,6BAAyB,YAE1CoB,WAAY,OACT/C,IAkCP,SAAS8C,EACPnB,EAEAqB,EACAC,EACAjD,GAEA,IAAMyB,EAAM,GAAGe,EAAeb,EAAI3B,GAAkBgD,EAG9Cd,KACJN,OAAQ,IACL5B,GAECkD,EAAqBhB,EAAQiB,YAInC,OAHAjB,EAAQiB,aAAc,EACtBjB,EAAQN,OAAOwB,EAAI,KAEZvB,UAAQJ,EAAKS,GAASV,KAAK,SAAA6B,GAChC,OAAIH,EACKG,EAEa,SAAfJ,EACHI,EAASJ,KACTI,EAAStC,OAAOS,KAAK,SAACT,GAAiB,OAAAR,KAAKC,MAAM6B,EAAkBtB,iBC9X5DuC,EACd3B,EACA3B,GAEA,IAAMyB,EAAS1B,EAAaC,wBAAoC2B,EAE1DO,IACD,CAAEa,WAAY,OACd/C,GAEL,OAAO6B,UAAQJ,EAAKS,YCrCNqB,EAAcvD,GAC5B,IAAMwD,EAAWxD,EAAeG,eAAeqD,SACzCvC,EAAQjB,EAAeiB,OAASuC,EACtC,OAAUzD,EAAaC,qBAAiCyD,mBACtDxC,aACSjB,EAAe2B,qBAGZ+B,EAAY1D,GAC1B,IAAMwD,EAAWxD,EAAeG,eAAeqD,SAE/C,OADcxD,EAAeiB,OAASuC,KACrBA,WAQHG,EACd3D,GAIA,OAFgBA,EAAeG,eAEhByD,QAAQ5D,GAAgBwB,KAAK,SAACqC,GACzC,OAAOA,GAAsB,cAAdA,EAAKC,OAAyBD,EAAKE,kBAWxCC,EACdhE,GAGA,OAAOsD,EAAStD,EAAeiE,QAASjE,GACrCwB,KAAK,SAAC0C,GACL,OAAOA,EAAMC,eAAeC,aAE7BC,MAAM,WACL,MAAO,gBCdJC,kBAAP,eAAuC,aAAAC,mBAAAA,IAAAC,kBAErC,OADAC,KAAKC,UAAYD,KAAKC,UAAUC,OAAOH,GAChCC,MAcFH,eAAP,SAAoCM,GAClC,IAAMC,EAAK,QAAQD,EAAQ,IAAIA,MAAW,SAE1C,OAAKH,KAAKK,UAAaL,KAAKM,UAQxBH,GAAmB,MAAVA,IACXH,KAAKO,GAAQJ,OAGRH,KAAKQ,WAXVC,OAEKL,qGAEEJ,OA0BJH,uBAAP,WAOE,OANAG,KAAKQ,SACiB,EAAlBR,KAAKU,aACPV,KAAKO,GAAK,KAEZP,KAAKU,aACLV,KAAKO,GAAK,IACHP,MAmBFH,qBAAP,WACE,OAAIG,KAAKU,YAAc,EACrBD,OACE,qGAIJT,KAAKQ,SACLR,KAAKU,aACLV,KAAKO,GAAK,KAJDP,MAoBJH,gBAAP,WACE,OAAOG,KAAKW,YAAY,QAenBd,eAAP,WACE,OAAOG,KAAKW,YAAY,OAmBnBd,gBAAP,WACE,OAAOG,KAAKW,YAAY,QAanBd,iBAAP,SAAsCe,GACpC,OAAIZ,KAAKM,SACPG,OAEE,sHAIJT,KAAKa,WAAW,GAAKD,EAFZZ,MAgBJH,eAAP,SAAoCe,GAClC,OAAIZ,KAAKM,SACPG,OAEE,oHAIJT,KAAKa,WAAW,GAAKD,EAFZZ,MAmBJH,kBAAP,SAAuCiB,GAGrC,OAFAd,KAAKQ,SACLR,KAAKO,GAAK,IAAIO,EACPd,MAMFH,oBAAP,WAGE,OAFAG,KAAKQ,SACLR,KAAKe,UACEf,KAAKO,GAMPV,kBAAP,WAGE,OAFAG,KAAKQ,SACLR,KAAKe,UACE,IAAIlB,EAAmBG,KAAKO,EAAI,KAGjCV,wBAAR,SAAoBmB,GAClB,OAAIhB,KAAKiB,gBACPR,OAEE,oBAAqBT,KAAKiB,6BAA8BD,+CAEnDhB,OAGTA,KAAKQ,SAEU,KAAXR,KAAKO,GAAyB,QAAbS,EACnBP,OACE,oBAAqBO,kGAKzBhB,KAAKiB,eAAiBD,EACtBhB,KAAKO,GAAgB,KAAXP,KAAKO,EAAW,GAAK,IAC/BP,KAAKO,GAAQS,EAASE,mBALblB,OASHH,0BAAR,SAAsBsB,GACpB,MAAO,MAAMC,KAAKD,IAGZtB,uBAAR,SAAmBe,GACjB,OAAIA,aAAgBS,KACXT,EAAKU,UAGM,iBAATV,GAAqBZ,KAAKuB,cAAcX,GAC1C,IAAIA,MAGNA,GAGDf,mBAAR,WAAA,WAkBE,OAjBAG,KAAKiB,oBAAiBO,EAClBxB,KAAKK,WACPL,KAAKO,GAAK,IAAIP,KAAKyB,WAAWzB,KAAKa,WAAW,WAAUb,KAAKyB,WAC3DzB,KAAKa,WAAW,QAElBb,KAAKa,WAAa,MAACW,OAAWA,IAG5BxB,KAAKM,WACPN,KAAKO,GAAKP,KAAKC,UACZyB,IAAI,SAAAd,GACH,OAAOe,EAAKF,WAAWb,KAExBgB,KAAK,KACR5B,KAAKC,UAAY,IAGZD,MAGT6B,sBAAYhC,4BAAZ,WACE,OAA+B,EAAxBG,KAAKC,UAAU6B,wCAGxBD,sBAAYhC,4BAAZ,WACE,OAAOG,KAAKa,WAAWiB,QAAU9B,KAAKa,WAAW,IAAMb,KAAKa,WAAW,oCAGjEhB,oBAAR,WAEE,GAAsB,EAAlBG,KAAKU,WAMP,IALAD,OAEE,yBAAyBT,KAAKU,6EAGP,EAAlBV,KAAKU,YACVV,KAAKO,GAAK,IACVP,KAAKU,aAIT,IAAMqB,EAAO/B,KAAKO,EAClBP,KAAKO,EAAIwB,EAAKjE,QAAQ,0BAA2B,IAE7CiE,IAAS/B,KAAKO,GAChBE,OACE,oGAKJT,KAAKO,EAAIP,KAAKO,EAAEzC,QAAQ,UAAW,QAzUrC,WAAYyC,gBAAAA,MATJP,eAAmB,GACnBA,gBAAoB,GAEpBA,gBAAa,EAOnBA,KAAKO,EAAIA,WCzBGyB,EACdC,EAKAC,GAEA,IAAIlF,EAmBAmF,EAhBF1E,EADoB,iBAAXwE,GAAuBA,aAAkBpC,EACxC,CACRvB,WAAY,MACZnB,OAAQ,CACNoD,EAAG0B,IAIGvE,qBACRuE,EACA,CAAC,IAAK,MAAO,QAAS,YAAa,aACnC,CACE3D,WAAY,QAMlB,OAAQ4D,GACN,IAAK,OACHC,EAAO,UACP,MACF,IAAK,QACHA,EAAO,oBACP,MACF,IAAK,eAGH,GACoB,iBAAXF,GACLA,aAAkBpC,IACpBoC,EAAOzC,QAIP,OAAO/C,QAAQG,OAAO,IAAIC,MAAM,6DAFhCsF,EAAO,mBAAmBF,EAAOzC,kBAInC,MACF,QAEE2C,EAAO,6BAMX,OAHAnF,EAAM1B,EAAamC,GAAW0E,EAGvB/E,UAAQJ,EAAKS,GAASV,KAAK,SAAAqF,GAsBhC,OArBIA,EAAEC,YAA8B,IAAjBD,EAAEC,YACnBD,EAAEE,SAAW,WACX,IAAIC,EAeJ,MAZoB,iBAAXN,GACPA,aAAkBpC,EAElB0C,EAAa,CACXhC,EAAG0B,EACHO,MAAOJ,EAAEC,YAGXE,EAAaN,GACFO,MAAQJ,EAAEC,UAGhBL,EAAiBO,EAAYL,KAIjCE,aC5EKK,EACdR,GAEA,OAAOD,EAAqBC,EAAQ,iBCpBtBS,EAASC,EAAYC,GACnC,GAAqB,IAAjBD,EAAMb,OACR,MAAO,GAKT,IAFA,IAAMe,EAAS,GAENC,EAAI,EAAGA,EAAIH,EAAMb,OAAQgB,GAAKF,EACrCC,EAAOE,KAAKJ,EAAMK,MAAMF,EAAGA,EAAIF,IAGjC,OAAOC,WCyCOI,EACd1H,GAEA,IAAM2B,EAAK3B,EAAe2B,GACpBF,EAAS1B,EAAaC,wBAAoC2B,cAC1DgG,EAAcrB,OAAOsB,OAAO,GAAI5H,EAAgB,CACpD6H,YAAQ5B,EACR6B,WAAO7B,IAQH8B,wLAJDC,EAAiB,QAAShI,EAAe8H,MAAOH,GAChDK,EAAiB,SAAUhI,EAAe6H,OAAQF,IAGlBxB,IAAI,SAAAjE,GACvC,OAwCFT,EAxCmBA,EAyCnBzB,EAzCwBkC,EA2CjBL,UAAQJ,EAAKzB,GAAgBqE,MAAM,SAAA4D,GACxC,MAAO,CACLC,OAAQ,CAACD,MANf,IACExG,EACAzB,IAtCA,OAAOkB,QAAQiH,IAAIJ,GAAUvG,KAAK4G,GAGpC,SAASJ,EACPK,EACAC,EACAX,GAEA,OAAKW,GAAaA,EAAU/B,OAAS,EAC5B,GAKsBY,EAAcmB,EAAW,IAEtCnC,IAAI,SAAA2B,GACpB,OAKFO,EAL0BA,EAM1BC,EANgCR,EAOhCH,EAPuCA,EAShCrB,OAAOsB,OAAO,GAAID,UACtBU,GAAOC,EACR3F,gBACKgF,EAAY/F,gBACdyG,GAAOC,UATd,IACED,EACAC,EACAX,QAuBF,SAASS,EACPG,GAEA,IAAMC,EAAWD,EACdE,OAAO,SAAAC,GAAU,OAAAA,EAAOF,WACxBG,OAAO,SAACC,EAAYF,GAAW,OAAAE,EAAWjE,OAAO+D,EAAOF,WAAW,IAEhEN,EAASK,EACZE,OAAO,SAAAC,GAAU,OAAAA,EAAOR,SACxBS,OAAO,SAACC,EAAYF,GAAW,OAAAE,EAAWjE,OAAO+D,EAAOR,SAAS,IAE9DW,EAAqC,CAAEL,YAM7C,OAJoB,EAAhBN,EAAO3B,SACTsC,EAAaX,OAASA,GAGjBW,WCzFOC,EACd9I,GAEQ,IAAA2B,EAA6B3B,KAAlB+I,EAAkB/I,QAC/ByB,EAAS1B,EAAaC,wBAAoC2B,iBAY1DoG,EAAWZ,EAAM4B,EAAe,IAAI5C,IAAI,SAAA6C,GAAc,OAX1ClB,EAWmDkB,EAV7D9G,SACDlC,IACH8H,QACAlG,OAAQ,CAAEkG,WAELjG,UAAQJ,EAAKS,GACjBmC,MAAM,SAAA4D,GAAS,OAAGC,OAAQ,CAACD,MAPf,IAACH,EACV5F,IAWR,OAAOhB,QAAQiH,IAAIJ,GAChBvG,KAAK,SAAA+G,GACa,SAAXU,EAAYC,GAAqB,OAAAX,EACpCE,OAAO,SAAAC,GAAU,OAAAA,EAAOQ,KACxBP,OAAO,SAACC,EAAYF,GAAW,OAAAE,EAAWjE,OAAO+D,EAAOQ,KAAY,IAFvE,IAGMhB,EAASe,EAAS,UAClBJ,EAAwC,CAAEM,WAAYF,EAAS,eACrE,OAAOf,EAAO3B,cAAcsC,IAAcX,WAAWW,IC0C3D,SAASO,EAAgBC,GACvB,IAAMC,EAAUD,EAAUE,MAAM,SAAAC,GAAO,OAAAA,EAAIF,UACrCpB,EAA+BmB,EAAUV,OAAO,SAACC,EAAYY,GAAQ,OAAAZ,EAAWjE,OAAO6E,EAAItB,QAAU,KAAK,IAC1GuB,EAAoC,CAAEH,WAM5C,OAJoB,EAAhBpB,EAAO3B,SACTkD,EAASvB,OAASA,GAGbuB,WChFOC,EACd1J,GAEA,IAAMyB,EAAS1B,EAAaC,wBAC1BA,EAAe2B,kBAEXgI,EAAY,CAChBxJ,eAAgBH,EAAeG,eAC/ByB,OAAQ,IASV,MANqC,UAAjC5B,EAAe4J,cACjBD,EAAK/H,OAAOiG,OAAS7H,EAAe8H,MAEpC6B,EAAK/H,OAAOkG,MAAQ9H,EAAe8H,MAG9BjG,UAAQJ,EAAKkI,GC0DtB,SAASP,EAAgBC,GACvB,IAAMC,EAAUD,EAAUE,MAAM,SAAAC,GAAO,OAAAA,EAAIF,UACrCpB,EAA+BmB,EAAUV,OAAO,SAACC,EAAYY,GAAQ,OAAAZ,EAAWjE,OAAO6E,EAAItB,QAAU,KAAK,IAC1GuB,EAAyC,CAAEH,WAMjD,OAJoB,EAAhBpB,EAAO3B,SACTkD,EAASvB,OAASA,GAGbuB,WC9FO7F,EACd5D,GAEA,IAQQwD,EAEN/B,EATES,EAAU,CAAEa,WAAY,OAkB5B,MAf8B,iBAAnB/C,EACTyB,EAAM,uDAAuDzB,GAGvDwD,EACJxD,EAAewD,UAAYxD,EAAeG,eAAeqD,SAC3D/B,EAAS1B,EAAaC,uBAAmCyD,mBACvDD,GAEFtB,SACKlC,GACAkC,IAIAL,UAAQJ,EAAKS,GCEtB,SAAS2H,EACPpI,EACAzB,GAsBA,OApBAA,EAAe4B,UACbkI,KAAK,EACLC,UAAU,GACP/J,EAAe4B,QAIU,YAA1B5B,EAAegK,SACjBhK,EAAe4B,OAAOqI,OAAS,KAEH,QAA1BjK,EAAegK,SACjBhK,EAAe4B,OAAOkI,KAAM,GAGA,WAA1B9J,EAAegK,SAGjBhK,EAAe4B,OAAOsI,SAAU,EAChClK,EAAe4B,OAAOmI,UAAW,GAE5BlI,UAAQJ,EAAKzB,YC9DNmK,EACdnK,GAWA,OAAOkH,EATY,CACjBlC,EAAG,OAAOhF,EAAe2B,kBAAiB3B,EAAeiE,QACzDgD,MAAO,EACP1B,IAAK,GACL6E,UAAW,QACXjK,eAAgBH,EAAeG,eAC/B4C,WAAY,SAGiBvB,KAAK,SAAA6I,GAElC,GAA2B,EAAvBA,EAAeC,MAIjB,OAHSD,EAAe9B,QAAQgC,KAAK,SAACC,GACpC,OAAOA,EAAI7I,KAAO3B,EAAe2B,OCkJzC,SAAS8I,EACPzK,GAEA,IAAMwD,EAAWxD,EAAeG,eAAeqD,SACzCkH,EAAY1K,EAAeiB,OAASuC,EAGtC/B,EAAS1B,EAAaC,qBAAiCA,EAAe2B,YAa1E,OAVI+I,IAAclH,IAChB/B,EAAS1B,EAAaC,qBAAiC0K,YAAmB1K,EAAe2B,aAI3F3B,EAAe4B,OAAS,CACtBqI,OAAQjK,EAAeiE,QACvB0G,mBAAoB3K,EAAe2K,oBAG9B9I,UAAQJ,EAAKzB,YAGN4K,EACdC,EACAC,EACAC,EACAC,EACAhL,SAmEQiL,EAINC,EAeAC,EApFIC,EAAcN,EAAUb,QAAU,GAClC/F,EAAQkH,EAAYC,KAAK,SAAAC,GAC7B,OAAOA,EAAE3J,KAAO3B,EAAeiE,UAIjC,GAAI4G,EAAYU,QAAUT,EAAUS,MAClC,MAAMjK,MACJ,QAAQwJ,EAAUtH,gDAA+CqH,EAAYrH,gEAA+DxD,EAAeiE,yBAAwBjE,EAAe2B,+BAKtM,IAAKuC,GAA8B,IAArBkH,EAAY7E,OACxB,MAAMjF,MACJ,QAAQwJ,EAAUtH,mEAAkExD,EAAeiE,+BAA8BjE,EAAe2B,uCAkFpJ,OAhDIwJ,EA1BAjH,EAGE6G,GAAqD,WAApC7G,EAAMC,eAAeC,YAExC8G,EAAUxB,EAAsB,CAC9B/H,GAAI3B,EAAeiE,QACnB6D,MAAO,CAACgD,EAAUtH,UAClBoG,cAAe,QACfzJ,eAAgBH,EAAeG,iBAE9BqB,KAAK,SAAC+G,GAEL,IAAMC,EAAWD,EAAQA,QAAQI,OAC/B,SAAC6C,EAAYC,GAIX,OAHKA,EAAMnC,SACTkC,EAAIhE,KAAKiE,EAAMjI,UAEVgI,GAET,IAGF,OAAOtK,QAAQC,QAAQ,CAAEqH,eAE1BnE,MAAM,WAAM,OAAGmE,SAAU,CAACsC,EAAUtH,aAC9B,SAACkI,GAAmB,OAAAhC,EAAsB,CACjD/H,GAAI3B,EAAeiE,QACnB6D,MAAO,CAACgD,EAAUtH,UAClBoG,cAAe,SACfzJ,eAAgBH,EAAeG,iBAE9BqB,KAAK,WAAM,OAAAkK,IACXrH,MAAM,WAAM,OAAAqH,OAIfR,EAAUhK,QAAQC,QAAQ,CAAEqH,SAAU,KAC7B,SAAAkD,GAAkB,OAAAxK,QAAQC,QAAQuK,MAIvCT,EAAWF,EAAgB,SAAW,QAI5CG,EAAUxD,OACR/F,GAAI3B,EAAeiE,UAClBgH,GAAW,CAACH,EAAUtH,UACvBb,iBAAgB3C,EAAeG,mBAE9BqB,KAAK,SAAA+G,GAIJ,GAAIA,EAAQL,QAAUK,EAAQL,OAAO3B,OACnC,MAAMgC,EAAQL,OAAO,GAEvB,OAAOK,IAERlE,MAAM,WAAM,OAAGmE,SAAU,CAACsC,EAAUtH,aAC9B,SAACkI,GACR,OAAO5C,EAAiB,CACtBnH,GAAI3B,EAAeiE,QACnB6D,MAAO,CAACgD,EAAUtH,UAClBrD,eAAgBH,EAAeG,iBAE9BqB,KAAK,WAEJ,OAAOkK,MAKR,CACLR,QAASA,EAAQ1J,KAAK,SAAAmK,GACpB,GAAIA,EAAmBnD,SAASjC,OAC9B,MAAM,IAAIjF,MAAM0J,GAElB,OAAOW,IAETR,mBCxRYS,EACdjK,EACA3B,GAGA,IAAM6L,EAAWlK,GAAU,OACrBF,EAAS1B,EAAaC,eAA2B6L,EAGjD3J,IACD,CAAEa,WAAY,OACd/C,GAIL,OAAO6B,UAAQJ,EAAKS,sDC4DpBlC,GAOA,IAAMwD,EAAWC,mBAAmBzD,EAAeG,eAAeqD,UAE5D/B,EADY1B,EAAaC,uBACawD,kBAAwBxD,EAAe8L,uBAE7E5J,OAA0ClC,GAChD,OAAO6B,UAAQJ,EAAKS,6CClFpBlC,GAEA,IAAMkC,KACJ7B,KAAM,CACJsB,GAAI3B,EAAe2B,GACnBjB,KAAMV,EAAeU,OAEpBV,GAML,cAHOkC,EAAQP,UACRO,EAAQxB,KAERa,EAAWW,2BCjBlBlC,GAEA,IAAM+L,EAAU/L,EAAe+L,QAE/B,OAAKC,OAAOC,UAAUF,IAAYA,EAAU,GAAe,IAAVA,EACxC7K,QAAQG,OAAO,IAAIC,MAAM,sEAG3BN,EAAehB,GAAgBwB,KAAK,SAAAP,GAEzC,IAAMQ,EAAS1B,EAAaC,qBAAiCiB,YAC3DjB,EAAe2B,uBACGoK,EAEd7J,EAAUC,qBACdnC,EACA,CAAC,QACD,CAAE4B,YAAa5B,EAAe4B,UAGhC,OAAOC,UAAQJ,EAAKS,qCDkBtBlC,GAEA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMQ,EAAS1B,EACbC,qBACiBiB,qBAEbiB,EAAUC,qBACdnC,EACA,CAAC,eAAgB,oBAAqB,oBACtC,CAAE4B,YAAa5B,EAAe4B,UAEhC,OAAOC,UAAQJ,EAAKS,iCAgCtBlC,GAEA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMQ,EAAS1B,EAAaC,qBAAiCiB,YAC3DjB,EAAe2B,mBAYjB,OATA3B,EAAe4B,UACbd,KAAMd,EAAekM,SACrBlJ,SAAUhD,EAAea,KACzBsL,gBAAiBnM,EAAeoM,OAChCrL,KAAMf,EAAeqM,QACrBrC,OAAQhK,EAAesM,QAAU,UAAY,WAC1CtM,EAAe4B,QAGbC,UAAQJ,EAAKzB,kCCpBtBA,GAEA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMQ,EAAS1B,EAAaC,qBAAiCiB,YAC3DjB,EAAe2B,aAGjB,OAAOE,UAAQJ,EAAKzB,kCA7CtBA,GAEA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMQ,EAAS1B,EAAaC,qBAAiCiB,YAC3DjB,EAAe2B,aAGXO,EAAUC,qBACdnC,EACA,GACA,CACE4B,cACK5B,EAAe4B,QACfxB,EAAcJ,EAAeK,SAKtC,OAAOwB,UAAQJ,EAAKS,8BrBjDtBlC,GAEA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IACMQ,EADa1B,EAAaC,qBAAiCiB,kBAQjE,OALAjB,EAAe4B,UACb2K,MAAOvM,EAAeuM,OACnBvM,EAAe4B,QAGbC,UAAQJ,EAAKzB,6BsBzBtBA,GAEA,IAAMyB,EAAS1B,EAAaC,4BAO5B,OALAA,EAAe4B,cACV5B,EAAe4B,QACf5B,EAAekE,OAGbrC,UAAQJ,EAAKzB,uCCcpBA,GAEA,IAAMyB,EAAS1B,EAAaC,wBAC1BA,EAAe2B,yBAGXO,KACJN,UACE4K,QAASxM,EAAewM,QACxBC,QAASzM,EAAeyM,QACxB3E,MAAO9H,EAAe8H,MACtB4E,wBACE1M,EAAe0M,yBAA2B,QAC5CC,SAAU3M,EAAe2M,SACzBC,mBAAoB5M,EAAe4M,mBACnCC,WAAY7M,EAAe8H,OAAyC,IAAhC9H,EAAe8H,MAAMvB,QACtDvG,EAAe4B,SAEjB5B,GAEL,OAAO6B,UAAQJ,EAAKS,0BvBkEpBlC,GAOA,OAAO8B,EAJSgL,GACdpL,SAAU,MACP1B,6DavEgCkC,GACrC,IAU8BA,EAVxBT,EAAS1B,EAAamC,sCAEtB6F,EAS0BZ,GADFjF,EATSA,GAUe4F,MAAO5F,EAAQ6K,WAAa,IAC/D5G,IAAI,SAAA2B,GAAS,OAMDA,EANyBA,EAMRH,EANezF,GAOzDlC,EAAgDsG,OAAOsB,OAAO,GAAID,IAEzD/F,cACV5B,EAAe4B,SAClBkG,QACA0E,QAAS7E,EAAY6E,QACrBC,QAAS9E,EAAY8E,QACrBC,wBAAyB1M,EAAe0M,0BAGnC1M,EAXT,IAAiC8H,EAAiBH,EAC1C3H,IAjBmBmG,IAAI,SAAA6G,GAAS,OAiCdvL,EAjC+BA,EAiCnBzB,EAjCwBgN,EAkCrDnL,UAAQJ,EAAKzB,GACjBqE,MAAM,SAAA4D,GAAS,OAAGC,OAAQ,CAACD,MAFhC,IAA0BxG,EAAYzB,IA/BpC,OAAOkB,QAAQiH,IAAIJ,GAAUvG,KAAK4H,iCM8DlCpJ,GAOA,IAAMwD,EAAWC,mBAAmBzD,EAAeG,eAAeqD,UAE5D/B,EADY1B,EAAaC,uBACawD,kBAAwBxD,EAAe8L,wBAE7E5J,OAA0ClC,GAChD,OAAO6B,UAAQJ,EAAKS,yDKjGI,SAAClC,GAEvB,IAAAG,EAKEH,iBAJEiN,EAIFjN,KAHFuM,EAGEvM,QAFFkN,EAEElN,eADFmN,EACEnN,mBAEJ,OAAOgB,EAAehB,GACnBwB,KAAK,SAAAP,GAAS,OAAGlB,EAAaC,qBAAiCiB,cAC/DO,KAAK,SAAAC,GAAO,OAAAI,UAAQJ,EAAK,CACtBsB,WAAY,OACZ5C,iBACAyB,OAAQ,CACNqL,SACAV,QACAW,eACAC,wErBDRxL,EACA3B,GAEA,IAAMyB,EAAS1B,EACbC,wBACoB2B,oBAGhBO,IACD,CAAEa,WAAY,OACd/C,GAEL,OAAO6B,UAAQJ,EAAKS,+BAWpBP,EACA3B,GAEA,IAAMyB,EAAS1B,EAAaC,sBAAkC2B,EAGxDO,EAA2B4K,IAC5B,CAAE/J,WAAY,QACjBnB,OAAQ,CAAEqF,MAAO,EAAG1B,IAAK,OACtBvF,GAQL,OAJIA,GAAkBA,EAAeoN,SACnClL,EAAQN,YAAc5B,EAAeoN,SAGhCvL,UAAQJ,EAAKS,6BAWpBP,EACA3B,GAEA,IAAMyB,EAAS1B,EAAaC,wBAAoC2B,WAE1DO,IACD,CAAEa,WAAY,OACd/C,GAEL,OAAO6B,UAAQJ,EAAKS,uBDjGpBP,EACA3B,GAEA,IAAMyB,EAAMe,EAAeb,EAAI3B,GAGzBkC,IACD,CAAEa,WAAY,OACd/C,GAEL,OAAO6B,UAAQJ,EAAKS,8CAoCpBP,EACA3B,GAEA,IAAMyB,EAASe,EAAeb,EAAI3B,WAE5BkC,IACD,CAAEa,WAAY,MAAOnB,OAAQ,IAC7B5B,GAOL,OAJIkC,EAAQpB,OACVoB,EAAQN,OAAOwB,EAAI,MAGdvB,UAAQJ,EAAKS,GAASmC,MAAM,SAAAgJ,GAOjC,IAJyBC,OACvB,2GAGmBzH,KAAKwH,EAAIZ,SAEvB,MAAMY,8BA6If1L,EACA3B,GAEA,IAAMyB,EAASe,EAAeb,EAAI3B,aAElC,OAAO6B,UAAQJ,EAAKzB,+CAiJpB2B,EACA3B,GAMA,OAAO0C,EAAYf,EAJHmL,OACX9M,IACHgD,SAAU,oDAvEZhD,GAEA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMQ,EAAS1B,EAAaC,qBAAiCiB,YAC3DjB,EAAe2B,YAEjB,OAAOE,UAAQJ,EAAKzB,iCAhHtBiN,EACAjN,GAEA,IAAMuN,EAASvN,EAAeuN,QAAU,OACxC,OAAOzK,EAAYmK,EAAQ,cAAcjN,EAAegD,SAAYuK,EAAQvN,gCAhE5E2B,EACA3B,GAEA,IAAMyB,EAASe,EAAeb,EAAI3B,gBAM5BkC,OACDlC,GAIL,OAFAkC,EAAQN,UAAW2D,IAAK,KAASrD,EAAQN,QAElCC,UAAQJ,EAAKS,6BAkHpBlC,GAEA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMQ,EAAS1B,EAAaC,qBAAiCiB,YAC3DjB,EAAe2B,aAGXO,EAAUC,qBACdnC,EACA,CAAC,QAAS,WACV,CAAE4B,YAAa5B,EAAe4B,UAGhC,OAAOC,UAAQJ,EAAKS,iDuBrRtBP,EACA3B,GAGA,IAAM6L,EAAWlK,GAAU,OACrBF,EAAS1B,EAAaC,eAA2B6L,cAGjD3J,IACD,CAAEa,WAAY,OACd/C,GAIL,OAAO6B,UAAQJ,EAAKS,gDvBwFpBlC,GAEA,IAAMyB,EAASe,EACbxC,EAAe2B,GACf3B,mBAGIkC,KACJa,WAAY,MACZnB,OAAQ,CACN4L,UAAWxN,EAAewN,YAEzBxN,GAYL,MAT+C,iBAApCA,EAAeyN,iBACxBvL,EAAQN,OAAO6L,iBAAmBzN,EAAeyN,iBAEjDvL,EAAQN,OAAO8L,kBAAoB1N,EAAeyN,wBAG7CvL,EAAQsL,iBACRtL,EAAQuL,iBAER5L,UAAQJ,EAAKS,uBgBzIElC,GAEtB,OAAO4L,EAAU,KAAM5L,mDQwBK,SAC5BA,GAGE,IAAU2N,EAIR3N,WAHF2C,EAGE3C,QAHFiH,aAAQ,IACRrE,EAEE5C,MAFFuF,aAAM,KACNpF,EACEH,iBACE4N,EAASD,EAAS,IAAIA,EAAW,GAEvC,OAAO3M,EAAehB,GACnBwB,KAAK,SAACP,GAAU,OAAGlB,EAAaC,qBAAiCiB,EAAQ2M,IACzEpM,KAAK,SAACC,GAAQ,OAAAI,UAAQJ,EAAK,CAC1BsB,WAAY,MACZ5C,iBACAyB,OAAQ,CACNqF,QACA1B,yCPoBNvF,GAEA,IAAMwD,EAAWC,mBAAmBzD,EAAeG,eAAeqD,UAE5D/B,EADY1B,EAAaC,uBACawD,kBAAwBxD,EAAe8L,aAE/E5J,EAAU,CAAEa,WAAY,OAC5Bb,SAAelC,GAAmBkC,GAGlC,OAAOL,UAAQJ,EAAKS,kCA3CpBlC,GAEA,IAAIkC,EAAU,CAAEa,WAAY,OAEtBS,EAAWC,mBAAmBzD,EAAeG,eAAeqD,UAE5D/B,EADY1B,EAAaC,uBACawD,iBAC5CtB,SAAelC,GAAmBkC,GAGlC,OAAOL,UAAQJ,EAAKS,0DQnBpBlC,GAEA,IAAIkC,EAAU,CAAEa,WAAY,OAEtBS,EAAWC,mBAAmBzD,EAAeG,eAAeqD,UAE5D/B,EADY1B,EAAaC,uBACawD,mBAC5CtB,SAAelC,GAAmBkC,GAGlC,OAAOL,UAAQJ,EAAKS,2BCTpBlC,GAEA,IAAMwD,EACJxD,EAAewD,UAAYxD,EAAeG,eAAeqD,SACrD/B,EAAS1B,EACbC,uBACmByD,mBAAmBD,WAGxC,OAAO3B,UAAQJ,EAAKzB,0BCrCK6N,GACzB,OAAU9N,EAAa8N,uBAA4BpK,mBACjDoK,EAAQrK,uClBwDqBtB,GAC/B,IAW8BA,EAXxBP,EAAKO,EAAQP,GACbF,EAAS1B,EAAamC,wBAA6BP,YAEnDoG,EAS0BZ,GADFjF,EATSA,GAUe4F,MAAO,IAC1C3B,IAAI,SAAA2B,GAAS,OAMDA,EANyBA,EAMRH,EANezF,GAOzDlC,EAA2CsG,OAAOsB,OAAO,GAAID,IAEpD/F,cACV5B,EAAe4B,SAClBkG,QACAhE,KAAM9D,EAAe8D,KACrBgK,WAAY9N,EAAe8N,aAGtB9N,EAVT,IAAiC8H,EAAiBH,EAC1C3H,IAjBmBmG,IAAI,SAAA6G,GAAS,OAgCdvL,EAhC+BA,EAgCnBzB,EAhCwBgN,EAiCrDnL,UAAQJ,EAAKzB,GACjBqE,MAAM,SAAA4D,GAAS,OAAGC,OAAQ,CAACD,MAFhC,IAA0BxG,EAAYzB,IA9BpC,OAAOkB,QAAQiH,IAAIJ,GAAUvG,KAAK4H,kFmBrDlCpJ,GAEA,IAAMyB,EAAS1B,EAAaC,wBAC1BA,EAAe2B,WAGjB,OAAOE,UAAQJ,EAAKzB,0BAmBpBA,GAEA,IAAMyB,EAAS1B,EAAaC,wBAC1BA,EAAe2B,YAGjB,OAAOE,UAAQJ,EAAKzB,wB/B+GpBA,GAEA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMQ,EAAS1B,EAAaC,qBAAiCiB,YAC3DjB,EAAeiN,eAKfvL,GAFEA,EAAW1B,EAAe0B,WAEjB,IAOb,OALA1B,EAAe4B,UACb+L,OAAQjM,GACL1B,EAAe4B,QAGbC,UAAQJ,EAAKzB,8BgC9JtBA,GAEA,IAAMyB,EAAS1B,EAAaC,wBAC1BA,EAAe2B,cAGjB,OAAOE,UAAQJ,EAAKzB,2BCfpBA,GAEA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMQ,EAAS1B,EAAaC,qBAAiCiB,YAC3DjB,EAAe2B,cAEjB,OAAOE,UAAQJ,EAAKzB,8BCiBtB+N,GAEA,OAAOpK,EAAWoK,GAAiBvM,KAAK,SAAAwM,GACtC,IAAKA,EACH,MAAM1M,MACJ,QAAQyM,EAAgBpM,wFAI5B,IAAMF,EAAS1B,EAAagO,qBAC1BA,EAAgBE,uBACRF,EAAgBpM,eAEpBgI,EAAO,CACX/H,OAAQ,CACNsM,eAAgBH,EAAgBG,eAChCC,iBAAkBJ,EAAgBI,kBAEpChO,eAAgB4N,EAAgB5N,gBAElC,OAAO0B,UAAQJ,EAAKkI,8BC2DtB3J,GASA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMQ,EAAS1B,EACbC,qBACiByD,mBAAmBxC,OACpCjB,EAAe0B,mBAEjB,OAAOG,UAAQJ,EAAKzB,6BC7GIA,GAC1B,IAAMyB,EAAS1B,EAAaC,wBAC1BA,EAAe2B,aAEXO,OACDlC,GAEL,OAAO6B,UAAQJ,EAAKS,+CDDpBlC,GAEA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMQ,EAAS1B,EAAaC,qBAAiCiB,YAC3DjB,EAAe2B,aAEjB,OAAOE,UAAQJ,EAAKzB,wCAsBtBA,GAEA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMQ,EAAS1B,EACbC,qBACiBiB,wBAEbiB,EAAUC,qBACdnC,EACA,CAAC,eAAgB,oBAAqB,oBACtC,CAAE4B,YAAa5B,EAAe4B,UAGhC,OAAOC,UAAQJ,EAAKS,oCAWtBlC,GAEA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMQ,EAAS1B,EAAaC,qBAAiCiB,YAC3DjB,EAAe2B,sBAQjB,OAJA3B,EAAe4B,cACV5B,EAAe4B,SAClBsK,SAAUlM,EAAekM,WAEpBrK,UAAQJ,EAAKzB,oCPjCtBA,GAEA,IAAMwD,EAAWC,mBAAmBzD,EAAeG,eAAeqD,UAE5D/B,EADY1B,EAAaC,uBACawD,oBAA0BxD,EAAe2B,aAErF,OAAOE,UAAQJ,EAAKzB,wDSvBpBkC,GAEA,OAAOuE,EAAqBvE,EAAS,6CjC8HrCP,EACAyM,GAEA,IAAM3M,EAAS1B,EAAaqO,wBAAmCzM,cACzDO,EAAUC,qBACdiM,GAAiB,GACjB,CAAC,OAAQ,MAAO,QAAS,YAAa,YAAa,SAAU,cAC7D,CACErL,WAAY,QAGhB,OAAOlB,UAAQJ,EAAKS,4BiC7JpBwE,GAEA,OAAOD,EAAsBC,EAAQ,iDCMrCA,GAEA,OAAOD,EAAqBC,EAAQ,oDtBCpC1G,GAEA,IAAMyB,EAAM8B,EAAcvD,GAE1B,OAAI0D,EAAY1D,GAEP6J,EAAiBpI,EAAKzB,GAGtB2D,EAAW3D,GAAgBwB,KAAK,SAAA6M,GACrC,GAAIA,EACF,OAAOxE,EAAiBpI,EAAKzB,GAG7B,MAAMsB,MACJ,kCAAkCtB,EAAeG,eAAeqD,0GEZxExD,GAEA,OAAOmK,EAAsBnK,GAC1BwB,KAAK,SAAC8M,GACL,GAAIA,EAEF,MAAO,CACLrB,OAAQjN,EAAe2B,GACvB4M,UAAU,EACVC,cAAe,IAKC,IAAAhL,EAGhBxD,0BAFFiB,EAEEjB,QADF2K,EACE3K,qBACE0K,EAAYzJ,GAASuC,EAG3B,OAAIkH,IAAclH,EAGTtC,QAAQiH,IAAI,CACjBvE,EAAQ,CACNJ,WACArD,eAAgBH,EAAeG,iBAEjCyD,EAAQ,CACNJ,SAAUkH,EACVvK,eAAgBH,EAAeG,iBAEjC6D,EAAkBhE,KAEjBwB,KAAK,SAACmB,OAACkI,OAAaC,OAAW2D,OAG9B,OAiDZ,SACE5D,EACA6D,EACAD,EACAT,EACAlD,EACA9K,GAEA,IAAM2O,EAAuB,GAC7B,GAAI3O,EAAeiE,UAAY4G,EAAY+D,WACzC,GAAIF,EAAsB,CACxB,IAAKV,EAEH,MAAM1M,MAAM,uDAAuDtB,EAAeiE,eAAc4G,EAAYrH,sDAG9GmL,EAAqBnH,KAEnBoD,EACEC,EACAA,GACA,EACA,gBAAgBA,EAAYrH,qCAAoCxD,EAAeiE,+BAA8BjE,EAAe2B,mCAC5H3B,GAGF4K,EACEC,EACAC,GACA,EACe,SAAf2D,EACI,qBAAqB3D,EAAUtH,2BAA0BxD,EAAeiE,+BAA8BjE,EAAe2B,mCACrH,wBAAwBmJ,EAAUtH,oCAAmCxD,EAAeiE,+BAA8BjE,EAAe2B,mCACrI3B,SAGC,GAAIgO,EAETW,EAAqBnH,KACnBoD,EACEC,EACAA,GACA,EACA,gBAAgBA,EAAYrH,qCAAoCxD,EAAeiE,+BAA8BjE,EAAe2B,mCAC5H3B,SAGC,GAAmB,SAAfyO,EAET,MAAM,IAAInN,MAAM,kCAAkCuJ,EAAYrH,6DAA4DxD,EAAeiE,aAI7I,OAAO0K,EAtGUE,CACLhE,IAH6BF,EAK7B8D,EAJmC,cAArB5D,EAAY/G,OAAyB+G,EAAY9G,OAM/D+G,EACA9K,KAGHwB,KAAK,SAAAsN,GAEF,IAAAnM,EAMEmM,KANA3D,cAAW,CACXD,QAAShK,QAAQC,QAAQ,CAAEqH,SAAU,KACrC2C,OAAQ,SAACO,GACP,OAAOxK,QAAQC,QAAQuK,eAK7B,OAAOxK,QAAQiH,IAAI2G,EAAsB3I,IAAI,SAACxD,GAAgB,oBAC3DnB,KAAK,WAEJ,OAAOiJ,EAAazK,KAErBwB,KAAK,SAAAkK,GAKJ,OAAOP,EAAOO,OAMjBjB,EAAazK,KAErBwB,KAAK,SAAAuN,GACJ,GAAIA,EAAgBP,cAAcjI,OAChC,MAAMjF,MACJ,QAAQtB,EAAe2B,oCAAmC3B,EAAeiE,aAI3E,OAAO8K,+BczEb/O,GAEA,IAAMyB,EAAS1B,EAAaC,wBAC1BA,EAAe2B,gBAGjB,OAAOE,UAAQJ,EAAKzB,6BCtBpBA,GAEA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMQ,EAAS1B,EAAaC,qBAAiCiB,YAC3DjB,EAAe2B,gBAEjB,OAAOE,UAAQJ,EAAKzB,sCMPtBA,GAEA,OAAOmK,EAAsBnK,GAC1BwB,KAAK,SAAA8M,GAEJ,IAAKA,EAEH,OAAOpN,QAAQC,QAAQ,CACrB8L,OAAQjN,EAAe2B,GACvB4M,UAAU,EACVS,gBAAiB,KAKD,IAAAxL,EAEhBxD,0BADFiB,EACEjB,QAGJ,OAAOkB,QAAQiH,IAAI,CACjBnE,EAAkBhE,GAClB4D,EAAQ,CACNJ,WACArD,eAAgBH,EAAeG,mBAGhCqB,KAAK,SAACmB,OAAC8L,OAAY5D,OAEZnH,GADYzC,GAASuC,KACOA,EAC5BwK,EAA+B,cAArBnD,EAAY/G,OAAyB+G,EAAY9G,OAEjE,IAAKL,IAAgBsK,GAAW,CAAC,QAAS,SAASiB,QAAQR,GAAc,EAEvE,MAAMnN,MAAM,4CAA4CtB,EAAeiE,eAAcT,4EAIvF,OAeV,SACExD,GAEA,IAAMwD,EAAWxD,EAAeG,eAAeqD,SACzCkH,EAAY1K,EAAeiB,OAASuC,EAGtC/B,EAAS1B,EAAaC,qBAAiCA,EAAe2B,cAGtE+I,IAAclH,IAChB/B,EAAS1B,EAAaC,qBAAiC0K,YAAmB1K,EAAe2B,eAQ3F,OAJA3B,EAAe4B,OAAS,CACtBqI,OAAQjK,EAAeiE,SAGlBpC,UAAQJ,EAAKzB,GAlCLkP,CAAiBlP,KAEzBwB,KAAK,SAAAuN,GACJ,GAAIA,EAAgBC,gBAAgBzI,OAClC,MAAMjF,MACJ,QAAQtB,EAAe2B,sCAAqC3B,EAAeiE,SAI7E,OAAO8K,8BCpDjB/O,GAEA,IAAMyB,EAAS1B,EAAaC,wBAC1BA,EAAekE,MAAMvC,aAQvB,OALA3B,EAAe4B,cACV5B,EAAe4B,QACf5B,EAAekE,OAGbrC,UAAQJ,EAAKzB,6CxCmDpBA,GAEA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMQ,EAAS1B,EACbC,qBACiBiB,YAAejB,EAAe2B,iBASjD,OANA3B,EAAe4B,UACbuN,WAAYnP,EAAemP,WAC3BrO,KAAMd,EAAec,MAClBd,EAAe4B,QAGbC,UAAQJ,EAAKzB,oCAsBtBA,GAEA,OAAOgB,EAAehB,GAAgBwB,KAAK,SAAAP,GACzC,IAAMQ,EAAS1B,EACbC,qBACiBiB,YAAejB,EAAe2B,sBAiBjD,OAdA3B,EAAe4B,UACbd,KAAMd,EAAekM,SACrBlJ,SAAUhD,EAAea,KACzBsL,gBAAiBnM,EAAeoM,OAChCrL,KAAMf,EAAeqM,SAClBrM,EAAe4B,aAIkB,IAA3B5B,EAAesM,UACxBtM,EAAe4B,OAAOoI,OAAShK,EAAesM,QAC1C,UACA,WAECzK,UAAQJ,EAAKzB,4ByCrGtBA,GAGA,IAAMwD,EACJxD,EAAe6D,KAAKL,UAAYxD,EAAeG,eAAeqD,SAE1D4L,EAAerP,EACnBC,uBACmByD,mBAAmBD,aAWxC,OARAxD,EAAe4B,cACV5B,EAAe6D,MACf7D,EAAe4B,eAGb5B,EAAe6D,KAGfhC,UAAQuN,EAAWpP"}